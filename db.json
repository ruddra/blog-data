[{"published_at": "2427-02-11 09:51:45", "markdown": "Hello All,\n\nI hope you all are well. As you can see there is new interface for this blog which has been powered by Ghost and hosted in Github. For that you will see change in interface of this blog. I hope you will like the new look.\n\nBest regards,\nRuddra", "id": "4", "title": "Migrating To Ghost"}, {"published_at": "2427-02-11 11:09:06", "markdown": "When comes to using multiple languages in one single site, *Django* is very handy. You can use .po file to do your translation for you. \n\nProcess is very simple: First create .po file. To make .po file I would suggest to use **poedit** or **Rosetta**. Here is another option that is using django's very own Localisation. Second create a folder name locale within tour django project and add the language named (for example: **ru__RU** for Russian language) within locale. Within **ru___RU** folder, create another folder named 'LC__MESSAGES'. There save the **.po** file you have created. Save the **.po** file in name **django.po**. File Map:\n\n\n    Project\n      |\n      locale\n        |\n        ru_RU\n          |\n          LC_MESSAGES\n            |\n            django.po\n    \n\nNow run this command: `django-admin.py compilemessages` to generate **.mo** file(django.mo). Third comes to final touch. in Language settings in your **settings.py** add **ru_RU** like this:\n\n    LANGUAGES = (\n        ('en-us', 'English'),\n        ('ru_RU', 'Russian'),\n    )\n\n\n    LANGUAGE_CODE = 'en-us' 'ru_RU' \n\n\nAdd locale path :\n\n\n    LOCALE_PATHS = (\n        os.path.join(PROJECT_PATH, '../locale'),\n    )\n\nand finally add a middleware in in **MIDDLEWARE_CLASSES**.\n\n    'django.middleware.locale.LocaleMiddleware'\n\nThat should the trick.", "id": "5", "title": "Django Translation Using .po File"}, {"published_at": "2427-02-11 12:01:34", "markdown": "I wanted to add a rich text editor within *django* administrator. Its not that hard to add a rich text editor, as there are editors like <a href=\"ckeditor.com\">ckeditor</a>, <a href=\"http://www.tinymce.com/\">tinymce</a>. \n\nThere are multiple plugins for django like <a href=\"https://github.com/dwaiter/django-ckeditor\">django-ckeditor</a> or <a href=\"https://github.com/aljosa/django-tinymce\">django-tinymce</a> etc. It seemed very complicated to use for me. So what I did here is that I have downloaded <a href=\"http://ckeditor.com/\">ckeditor</a> stadard edition and extracted it in my Static folder and loaded the js file within  **templates>admin>base.html**.\n\nNow, using firebug, I retrieved the textarea *name/id/class* in which I wanted to add ckeditor using firebug (or from chrome/firefox: inspect elements). This process is simple, just load the page where your textarea(or any type of field) resides, open firebug and inspect that place.For example: lets say the model field I want to modify is named `blogbody`. So the element's name in admin site was `id_blogbody`(auto generated). In case of using a form, the input will be like following:\n\n\n##forms.py\n\n    blogbody= forms.CharField(widget=       forms.TextInput(attrs={'id': 'id_blogbody'}))\n\n##generated text\n\n    <input id='id_blogbody' ...>\n\nThen go to base.html and add this script:\n\n    <script>\n      CKEDITOR.replace(    'name_or_id_or_class_of_the_textfield' ); #in   this example CKEDITOR.replace( '#id_blogbody' )\n     </script>\n\n\nNow reload the page from admin site and a textfield with rich text editor will be generated!", "id": "6", "title": "RichText Editor in Django Admin Site"}, {"published_at": "2427-02-11 12:41:06", "markdown": "To add a virtual environment to **Intellij Idea**, You have added *virtualenv* folder's python to project SDK. Which means that *virtualenv* directory's python( for example **venv/bin/python2.7**) needs to be added to Intellij Idea project path. Here is a demonstration: \n\n###For Older versions:\n\nThe virtualenv directory's python( for example venv/bin/python2.7) needs to be added to IntelliJ Idea project path. Example: need to go to file>project structure (IntelliJ Idea)\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/virtualenv/1.jpg\">\n\npress (new) in Project SDK, and add new path to virtualenv's python directory like this:\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/virtualenv/2.jpg\">\n\nGo to Modules>Dependencies and set your module SDK to Python SDK which is marked on this picture: \n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/virtualenv/3.png\">\n\nClick on Django (option marked in next the image) and set Django project root, Settings, Manage Script like this:\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/virtualenv/4.jpg\">\n\nNow press ok and final look of the Project settings: \n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/virtualenv/5.jpg\">\n\nNow need to run the project.\n\n###For Pycharm 2016 and later\n\nTo add an existing virtual environment to the list of available interpreters\n\nIn the Project Interpreter page,\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/I226A.png\">\nIn the drop-down list, choose to Add local.\nadd environment option\n\nIn the Select Python Interpreter dialog box that opens, choose the desired Python executable, located inside the virtual environment folder, and click OK.\nGo to this link for more information.\nNow need to run the project.\n\nMy Stackoverflow Answer is here: http://stackoverflow.com/questions/20877106/using-intellijidea-within-an-existing-virtualenv/20879661#20879661", "id": "7", "title": "Using IntellijIdea Within An Exisiting Virtualenv"}, {"published_at": "2427-02-11 13:23:06", "markdown": "Let us make a test scenario here:\n**A dropdown field which on change we are going to send a Get/Post request to Django and return response.**\n\nLet us start coding....\n    \n    <select id=\"select_dropdown\">\n    <option value='joshua'>joshua</option>\n    <option value='peter'>peter</option>\n    ....\n    ....\n    </select>\n\nLet's make an `Ajax` request after the change in the dropdown field.\n\n\n    $(document).ready(function(){\n\n    $('#select_dropdown').change(function(){\n    var e = document.getElementById(\"select_dropdown\");\n    var value = e.options[e.selectedIndex].value;\n\n    $.ajax({\n        url: \"your-url\",\n        type: \"post\", // or \"get\"\n        data: value,\n        success: function(data) {\n\n          alert(data.result);\n        }});\n\n    });\n\n\nHere on change of a post request is called. Now let's handle the view.\n\n    import json\n    def post(request):\n\tif request.POST(): #os request.GET()\n    \tget_value= request.body\n    \t# Do your logic here coz you got data in `get_value`\n    \tdata = {}\n    \tdata['result'] = 'you made a request'\n\t\treturn HttpResponse(json.dumps(data), content_type=\"application/json\")\n\n\nThats all.", "id": "8", "title": "Sample Ajax GET/POST Request in Django"}, {"published_at": "2427-02-11 16:12:54", "markdown": "While surfing through <a href=\"stackoverflow.com\">stackoverflow</a>, I find a common question among Django users that, database not working properly; fields attribute changed, yet not working etc. Clearly because most of them used syncdb after altering fields. Well, lets make some things clear here about django **syncdb** and **migration**.\n\n##What is `syncdb`?\n\n**syncdb** is a command which is executed in django shell to create tables for first time for apps which are added to **INSTALLED_APPS** of *settings.py*. Need to keep in mind about two key words: 'First Time' and 'Newly Added Apps'. Because **syncdb** only works on models of those apps for first time to create initial tables in database. So once **syncdb** is executed, not model field altering, because if anyone does that, it will not work. Its clearly mentioned in <a href=\"https://docs.djangoproject.com/en/1.6/ref/django-admin/#syncdb\">documentation</a>:\n\n<blockquote>syncdb will only create tables for models which have not yet been installed. It will never issue ALTER TABLE statements to match changes made to a model class after installation. Changes to model classes and database schemas often involve some form of ambiguity and, in those cases, Django would have to guess at the correct changes to make. There is a risk that critical data would be lost in the process.\n\nIf you have made changes to a model and wish to alter the database tables to match, use the sql command to display the new SQL structure and compare that to your existing table schema to work out the changes.</blockquote>\n\nSo what if you need to change model field? No worries, migration is here to save you.\n\n##What is `migration`?\n\nMigration is a process to reconstruct database schema according to altered model fields. From Django 1.7(under development) <a href=\"https://docs.djangoproject.com/en/dev/topics/migrations/\">documentation</a>: \n\n<blockquote>Migrations are Django\u2019s way of propagating changes you make to your models (adding a field, deleting a model, etc.) into your database schema. They\u2019re designed to be mostly automatic, but you\u2019ll need to know when to make migrations, when to run them, and the common problems you might run into.</blockquote>\n\nSo, after using **syncdb**, if you need to alter model fields, then go ahead, and after that you have to migrate database. If you are using django <=1.6, then you can use <a href=\"http://south.aeracode.org/\">South</a>. If django is above 1.6, it has its own <a href=\"https://docs.djangoproject.com/en/dev/topics/migrations/\">migration</a> process.\n\nAnd of course, if you use **South** to migrate, you have to use **syncdb** before executing migration, because if you don't, initial database tables(including auth, auth_group_permission, django_admin_log etc) will not be created.\n\n##What if you mess-up in production server with syncdb and migration?\n\nIf you end up doing **syncdb** initially but need to change database, what should be done?\n\nEasy solution, keep the models in same state as it was during initial **syncdb** command. Then run `python manage.py schemamigration your_app_label --initial`**(in django <=1.6)** or `python manage.py makemigration your_app_label`**(django >=1.7)**.\n\nAfter that, run `python manage.py migrate your_app_label --fake`**(in django <=1.6)** or `python manage.py migrate your_app_label --fake-initial` **(django >=1.7)**. It will put a fake migration in the database which will occur no change in tables.\n\nThen change models and run `python manage.py migrate your_app_label`\n\n\n\n###PS: *syncdb is depricated from django 1.7, which will reduce the hassle of using syncdb and migration separately.*\n", "id": "9", "title": "Syncdb vs Migration"}, {"published_at": "2427-02-11 18:13:56", "markdown": "As <a href=\"https://docs.djangoproject.com/en/dev/topics/forms/formsets/\">documentation</a> says: <blockquote> A formset is a layer of abstraction to work with multiple forms on the same page. It can be best compared to a data grid</blockquote>.\n\nSo here I am going to show a very simple django formset implementation example.<!--more-->\n\nHere we are going to use the following model, form, template, view:\n\n##Model\n\n\n    class Product(models.Model):\n        name = models.CharField(max_length=50)\n        quantity = models.IntegerField()\n        price = models.IntegerField()\n\n    class Distributor(models.Model):\n        name = models.CharField(max_length=100)\n        products= models.ManyToManyField(Product)\n\nThese fairly simple models, where product is related to distributor model by a many-to-many relation.\n\n##Form\n\nFirst we declare productform, then using formset factory helps to create multiple instances of product. Then we add this to distributor form like below:\n\n\n    from django import forms\n    from django.forms.formsets import formset_factory\n    class ProductForm(forms.Form):\n        name = forms.CharField()\n        quantity = forms.IntegerField()\n        price = forms.IntegerField()\n\n    ProductFormset= formset_factory(ProductForm)\n\n    class DistributorForm(forms.Form):\n       name= forms.CharField()\n       products= ProductFormset()\n\nNow we use this form in template.\n\n##Template\n\n      <form action=\"\" method=\"post\" class=\"\">\n      {% csrf_token %}\n      <h2> Distributors :</h2>\n      {% for field in form %}\n        {{ field.errors }}\n        {{ field.label_tag }} : {{ field }}\n      {% endfor %}\n      {{ form.products.management_form }}\n\n      <h3> Product Instance(s)</h3>\n      <table id=\"table-product\">\n        <thead>\n          <tr>\n            <th>name</th>\n            <th>quantity</th>   \n            <th>price</th>\n          </tr>\n          </thead>\n          <tbody class=\"product-instances\">\n          <tr>\n            <td>{{ form.product }}</td>\n            <td>{{ form.product }}</td>   \n            <td>{{ form.product }}</td>\n            <td> <input id=\"input_add\" type=\"button\" name=\"add\" value=\" Add More \" class=\"tr_clone_add btn data_input\"> </td>\n          </tr>\n          </tbody>\n      {% endfor %}\n      </table>\n                  <input type=\"submit\" name=\"submit\" class=\"button\" value=\"Save\"/>\n      </form>\n\n    <script>\n            var i = 1;\n            $(\"#input_add\").click(function() {\n                $(\"tbody tr:first\").clone().find(\".data_input\").each(function() {\n                    if ($(this).attr('class')== 'tr_clone_add btn data_input'){\n                        $(this).attr({\n                            'id': function(_, id) { return \"remove_button\" },\n                            'name': function(_, name) { return \"name_remove\" +i },\n                            'value': 'Remove'\n                        }).on(\"click\", function(){\n                            var a = $(this).parent();\n                            var b= a.parent();\n                            i=i-1\n                            $('#id_form-TOTAL_FORMS').val(i);\n                            b.remove();\n\n                            $('.product-instances tr').each(function(index, value){\n                                $(this).find('.data_input').each(function(){\n                                    $(this).attr({\n                                        'id': function (_, id) {\n                                            var idData= id;\n                                            var splitV= String(idData).split('-');\n                                            var fData= splitV[0];\n                                            var tData= splitV[2];\n                                            return fData+ \"-\" +index + \"-\" + tData\n                                        },\n                                        'name': function (_, name) {\n                                            var nameData= name;\n                                            var splitV= String(nameData).split('-');\n                                            var fData= splitV[0];\n                                            var tData= splitV[2];\n                                            return fData+ \"-\" +index + \"-\" + tData\n                                        }\n                                    });\n                                })\n                            })\n                        })\n                    }\n                    else{\n                        $(this).attr({\n                            'id': function (_, id) {\n                                var idData= id;\n                                var splitV= String(idData).split('-');\n                                var fData= splitV[0];\n                                var tData= splitV[2];\n                                return fData+ \"-\" +i + \"-\" + tData\n                            },\n                            'name': function (_, name) {\n                                var nameData= name;\n                                var splitV= String(nameData).split('-');\n                                var fData= splitV[0];\n                                var tData= splitV[2];\n                                return fData+ \"-\" +i + \"-\" + tData\n                            }\n                        });\n\n                    }\n                }).end().appendTo(\"tbody\");\n                $('#id_form-TOTAL_FORMS').val(1+i);\n                i++;\n\n            });\n        </script>\n\nThe html part is fairly simple, like using form in template. Then the JS is being used so that multiple instances of product form can be generated like: \n\n    <!-- First row of the table -->\n\n    <tr><td><input type=\"text\" name=\"form-0-name\" id=\"id_form-0-name\" /></td>\n    <td><input type=\"number\" name=\"form-0-quantity\" id=\"id_form-0-quantity\" /></td>\n    <td><input type=\"number\" name=\"form-0-price\" id=\"id_form-0-price\" /></td>\n    <td> <input id=\"input_add\" type=\"button\" name=\"add\" value=\" Add More \" class=\"tr_clone_add btn data_input\"> </td> </tr>\n\n    <!-- Second row of the table -->\n\n    <tr><td><input type=\"text\" name=\"form-1-name\" id=\"id_form-1-name\" /></td>\n    <td><input type=\"number\" name=\"form-1-quantity\" id=\"id_form-1-quantity\" /></td>\n    <td><input type=\"number\" name=\"form-1-price\" id=\"id_form-1-price\" /></td>\n    <td> <input id=\"remove_button\" type=\"button\" name=\"remove_button1\" value=\" Remove \" class=\"tr_clone_add btn data_input\"> </td> </tr>\n\n    <!-- more inline formset are going to rendered here -->\n\n\n##View\n\nHere values from the form are being saved to database.\n\n        def post(request):\n                form = DistributorForm(request.POST)\n                form.product_instances = ProductFormset(request.POST)\n                if form.is_valid():\n                    distributor= Distributor() #model class\n                    distributor.name= form.cleaned_data('name')\n                    distributor.save()\n                    if form.product_instances.cleaned_data is not None:\n                        for items in form.product_instances.cleaned_data:\n                            product = Product() #Product model class\n                            product.name= item['name']\n                            product.quantity= item['quantity']\n                            product.price= item['price']\n                            product.save()\n                            distributor.products.add(product)\n                    return redirect('/success')\n                return redirect('/failure')\n\n\n\nOutput should look like this:\n\n<img src=\"https://dl.dropboxusercontent.com/u/235131545/myblog/formset.JPG\">\n\n<b>Notes to keep in mind:</b>\n\nFirst, need to be careful about things like:\n\n\n    <input type=\"hidden\" name=\"form-TOTAL_FORMS\" value=\"1\" id=\"id_form-TOTAL_FORMS\" />\n    <input type=\"hidden\" name=\"form-INITIAL_FORMS\" value=\"0\" id=\"id_form-INITIAL_FORMS\" />\n    <input type=\"hidden\" name=\"form-MAX_NUM_FORMS\" id=\"id_form-MAX_NUM_FORMS\" />\n\n\nHere **form-TOTAL_FORMS** 's value should be equal to number of rows in table. The code above must exist in order to formset to work.\n\nSecond, in **views.py**, formset form class needs to be called, else cleaned data within the formset can't be found.\n\n    form.product_instances = ProductFormset(request.POST)\n\nThats all.", "id": "10", "title": "Working with Formset"}, {"published_at": "2427-02-11 20:05:26", "markdown": "###I am assuming you have read celery docs from <a href=\"http://celery.readthedocs.org/en/latest/index.html\">Celery Documentation</a>\n\nAs we know, celery can be used as a scheduler for executing asynchronous tasks in periodic cycles. Here I am going to share to do that with a code example. But I am going to avoid theoretical knowledge here because you can read them in celery documentation. \n\nFirst install celery: `pip install django-celery`.\n\n##Configuring Brokers\n\nWe are using django database as Broker. For detail understanding, check here: http://celery.readthedocs.org/en/latest/getting-started/brokers/django.html\n\n##Making Periodic Task\n\nHere is the project structure we are going to use:-\n\n\n    project\n     -settings.py\n     -manage.py\n     -app1\n      -views.py\n      -models.py\n     -app2\n      -views.py\n      -models.py\n\nLets say, we want to add periodic task to **app1**. So structure of the project will be like this:-\n\n    project\n     -settings.py\n     -manage.py\n     -app1\n      -__init__py\n      -celery.py\n      -tasks.py\n      -views.py\n      -models.py\n     -app2\n      -views.py\n      -models.py\n\n\nNo need to panic to see two new .py files. They will be created in time. :)\n\nNow, we need to add celery configuration in:\n\n **settings.py**:-\n\n\n    from __future__ import absolute_import\n    BROKER_URL = 'pyamqp://guest:guest@wlocalhost:5672//' #read docs\n    CELERY_IMPORTS = ('app1.tasks', )\n    from celery.schedules import crontab\n    from datetime import timedelta\n\n    CELERYBEAT_SCHEDULE = {\n      'schedule-name': { \n                          'task': 'app1.tasks.email_sending_method',  # We are going to create a email_sending_method later in this post.\n                          'schedule': timedelta(seconds=30),\n                          },\n      }\n    \nAs you can see, **task** in **CELERYBEAT__SCHEDULE** is name as **app1.tasks.email___sending___method** because in next section we are making a **email___sending__method** method which going to send an email every 30 seconds.\n\nAnd in installed apps, we need to add **djcelery** :-\n\n\n    INSTALLED_APPS = (\n      ...\n     'djcelery'\n    )\n\nNow we shall add a **celery.py** file in **app1** directory:-\n\n      from __future__ import absolute_import\n      import os\n      from celery import Celery\n      import django\n      from django.conf import settings\n      os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'settings')\n      app = Celery('app1.email_sending_method')\n      app.config_from_object('django.conf:settings')\n      app.autodiscover_tasks(lambda: settings.INSTALLED_APPS)\n\n      app.conf.update(\n          CELERY_RESULT_BACKEND='djcelery.backends.database:DatabaseBackend',\n          )\n      @app.task(bind=True)\n      def debug_task(self):\n          print('Request: {0!r}'.format(self.request))\n\n\nand update the `__init__.py` file within the directory:-\n\n\n    from __future__ import absolute_import\n    from celery import app as celery_app\n\n\nNow we are going to add a **tasks.py** which is actually going to be executed while running celery.\n\n\n    from __future__ import absolute_import\n    import datetime\n    from celery.task.base import periodic_task\n    from django.core.mail import send_mail\n\n    @periodic_task(run_every=datetime.timedelta(seconds=30))\n    def email_sending_method():\n        send_mail('subject', 'body', 'from_me@admin.com' , ['to_me@admin.com'], fail_silently=False) \n\nAdd respective credentials/configurations for sending mail, and then run this piece of code in command prompt:-\n\n`celery -A app1 worker -B -l info`\n\nAnd that should do the trick, we will get mails after every 30 seconds. \n\n\n####PS: Although there might a key-error, but it won't occur any problems.", "id": "11", "title": "Perodic Tasks By Celery 3.1 Example"}, {"published_at": "2427-02-12 22:16:11", "markdown": "Django has its own implementation for **reset/forgot password** for its admin site. We are going to use that piece of code as reference to implement similar feature for a non admin-site authentication page. Although there are tons of good packages which will allow user to use their password reseting system. But if the system isn't too complex and doesn't need such authentication plugins, then reusing the django's very own implementation can be a good option.\n\nClass based view is going to be used instead of method based view(for no particular reason, so using either of them is alright.). And please read the comments of the example codes for better understanding of implementation.\n\n\nThis implementation is going to divided into two parts. First part is sending an email with reset url, and the Second part is clicking the reset url attached in email and entering new password for reset completion.\n\nBefore starting anything, lets look at the django's reset/forgot password's implementation in *django/contrib/auth/forms.py* (<a href='https://github.com/django/django/blob/89559bcfb096ccc625e0e9ab41e2136fcb32a514/django/contrib/auth/forms.py'>source</a>) and *django/contrib/auth/views.py* (<a href='https://github.com/django/django/blob/89559bcfb096ccc625e0e9ab41e2136fcb32a514/django/contrib/auth/views.py'>source</a>).\n\n##Implemetation of sending an email for forgot password with reset url\n\nFirst need to configure smtp/email configuration so the system can send email. Gmail's SMTP service is going to be used here.\n\n    EMAIL_USE_TLS = True\n    DEFAULT_FROM_EMAIL = 'test@gmail.com'\n    SERVER_EMAIL = 'test@gmail.com'\n    EMAIL_HOST = 'smtp.gmail.com'\n    EMAIL_PORT = 587\n    EMAIL_HOST_USER = 'test@gmail.com'\n    EMAIL_HOST_PASSWORD = 'test123##'\n    EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'\n\nNow we are going to make a <b>reset password form</b> where we are going to add an text field which will take either username or email address associated with the corresponding user.\n\n    from django import forms\n\n    class PasswordResetRequestForm(forms.Form):\n        email_or_username = forms.CharField(label=(\"Email Or Username\"), max_length=254)\n\n\nWe are going to make a <b>view</b> which will check the input email/username and send an email to user's email address(implementation reference: <a href='https://github.com/django/django/blob/89559bcfb096ccc625e0e9ab41e2136fcb32a514/django/contrib/auth/forms.py#L235'>source</a>).\n\n\n        from django.contrib.auth.tokens import default_token_generator\n        from django.utils.encoding import force_bytes\n        from django.utils.http import urlsafe_base64_encode, urlsafe_base64_decode\n        from django.template import loader\n        from django.core.validators import validate_email\n        from django.core.exceptions import ValidationError\n        from django.core.mail import send_mail\n        from settings import DEFAULT_FROM_EMAIL\n        from django.views.generic import *\n        from utils.forms.reset_password_form import PasswordResetRequestForm\n        from django.contrib import messages\n        from django.contrib.auth.models import User\n        from django.db.models.query_utils import Q\n\n        class ResetPasswordRequestView(FormView):\n            template_name = \"account/test_template.html\"    #code for template is given below the view's code\n            success_url = '/account/login'\n            form_class = PasswordResetRequestForm\n\n            @staticmethod\n            def validate_email_address(email):\n            '''\n            This method here validates the if the input is an email address or not. Its return type is boolean, True if the input is a email address or False if its not.\n            '''\n                try:\n                    validate_email(email)\n                    return True\n                except ValidationError:\n                    return False\n\n            def post(self, request, *args, **kwargs):\n            '''\n            A normal post request which takes input from field \"email_or_username\" (in ResetPasswordRequestForm). \n            '''\n                form = self.form_class(request.POST)\n                if form.is_valid():\n                    data= form.cleaned_data[\"email_or_username\"]\n                if self.validate_email_address(data) is True:                 #uses the method written above\n                    '''\n                    If the input is an valid email address, then the following code will lookup for users associated with that email address. If found then an email will be sent to the address, else an error message will be printed on the screen.\n                    '''\n                    associated_users= User.objects.filter(Q(email=data)|Q(username=data))\n                    if associated_users.exists():\n                        for user in associated_users:\n                                c = {\n                                    'email': user.email,\n                                    'domain': request.META['HTTP_HOST'],\n                                    'site_name': 'your site',\n                                    'uid': urlsafe_base64_encode(force_bytes(user.pk)),\n                                    'user': user,\n                                    'token': default_token_generator.make_token(user),\n                                    'protocol': 'http',\n                                    }\n                                subject_template_name='registration/password_reset_subject.txt' \n                                # copied from django/contrib/admin/templates/registration/password_reset_subject.txt to templates directory\n                                email_template_name='registration/password_reset_email.html'    \n                                # copied from django/contrib/admin/templates/registration/password_reset_email.html to templates directory\n                                subject = loader.render_to_string(subject_template_name, c)\n                                # Email subject *must not* contain newlines\n                                subject = ''.join(subject.splitlines())\n                                email = loader.render_to_string(email_template_name, c)\n                                send_mail(subject, email, DEFAULT_FROM_EMAIL , [user.email], fail_silently=False)\n                        result = self.form_valid(form)\n                        messages.success(request, 'An email has been sent to ' + data +\". Please check its inbox to continue reseting password.\")\n                        return result\n                    result = self.form_invalid(form)\n                    messages.error(request, 'No user is associated with this email address')\n                    return result\n                else:\n                    '''\n                    If the input is an username, then the following code will lookup for users associated with that user. If found then an email will be sent to the user's address, else an error message will be printed on the screen.\n                    '''\n                    associated_users= User.objects.filter(username=data)\n                    if associated_users.exists():\n                        for user in associated_users:\n                            c = {\n                                'email': user.email,\n                                'domain': 'example.com', #or your domain\n                                'site_name': 'example',\n                                'uid': urlsafe_base64_encode(force_bytes(user.pk)),\n                                'user': user,\n                                'token': default_token_generator.make_token(user),\n                                'protocol': 'http',\n                                }\n                            subject_template_name='registration/password_reset_subject.txt'\n                            email_template_name='registration/password_reset_email.html'\n                            subject = loader.render_to_string(subject_template_name, c)\n                            # Email subject *must not* contain newlines\n                            subject = ''.join(subject.splitlines())\n                            email = loader.render_to_string(email_template_name, c)\n                            send_mail(subject, email, DEFAULT_FROM_EMAIL , [user.email], fail_silently=False)\n                        result = self.form_valid(form)\n                        messages.success(request, 'Email has been sent to ' + data +\"'s email address. Please check its inbox to continue reseting password.\")\n                        return result\n                    result = self.form_invalid(form)\n                    messages.error(request, 'This username does not exist in the system.')\n                    return result\n                messages.error(request, 'Invalid Input')\n                return self.form_invalid(form)\n\nAs you see above, the code is fairly simple(although it looks long). An encoded user id has been generated here using **urlsafe__base64___encode(force___bytes(user.pk))** and a token by using **default___token___generator.make___token(user)**. This user id is going to be used later to get the user, the token will be used for checking validity of the url for that user and both the token and the user id is going to be used as unique reference for reset password url. **c** is a dictionary which has user id, token and other related data etc. This dictionary is going to be blent with the template `registration/password_reset_email.html` and send to the user's email address.\n\nFor displaying messages(if you are using messages framework of django-1.7, details: <a href='https://docs.djangoproject.com/en/dev/ref/contrib/messages/#displaying-messages'>source</a>), add this piece of code in your template:\n\n\n        {# test template #}\n        <!-- code for displaying success or error message in template -->\n        {% if messages %}\n        <ul class=\"messages\">\n            {% for message in messages %}\n            <li>{% if message.tags %} class=\"{{ message.tags }}\"{% endif %}>{{ message }}</li>\n            {% endfor %}\n            {% endif %}\n        </ul>\n\n        <!-- Form rendering code for template -->\n        <form action=\"\" method=\"post\">\n\n            {% csrf_token %}\n            {{ form.as_p }}\n\n            <input type=\"submit\" value=\"Submit\" />\n        </form>\n\nTwo more things before wrapping up sending email part. One, making a <b>url</b> for using this view.\n\n\n    urlpatterns = patterns('',\n                           url(r'^admin/', include(admin.site.urls)),\n                           # url(r'^account/reset_password_confirm/(?P<uidb64>[0-9A-Za-z]+)-(?P<token>.+)/$', PasswordResetConfirmView.as_view(),name='reset_password_confirm'), \n                           # PS: url above is going to used for next section of implementation.\n                           url(r'^account/reset_password', ResetPasswordRequestView.as_view(), name=\"reset_password\"),  \n                           )\n\n\nTwo, editing the template of **registration/password_reset_email.html** or else you will get errors.\n\n\n    {% load i18n %}{% autoescape off %}\n    {% blocktrans %}You're receiving this email because you requested a password reset for your user account at {{ site_name }}.{% endblocktrans %}\n\n    {% trans \"Please go to the following page and choose a new password:\" %}\n        {% block reset_link %}\n            {{ domain }}{% url 'reset_password_confirm' uidb64=uid token=token %} \n            <!--This is the only change from ` django/contrib/admin/templates/registration/password_reset_subject.html`. the url name is commented out in urls.py section. The view associated with the url is going to described later in this post. -->\n        {% endblock %}\n    {% trans \"Your username, in case you've forgotten:\" %} {{ user.get_username }}\n\n    {% trans \"Thanks for using our site!\" %}\n\n    {% blocktrans %}The {{ site_name }} team{% endblocktrans %}\n\n    {% endautoescape %}\n\nNow run the server and you will see forms like the screen shots below: (This screenshots look cool because django adminsite's js/css have been used here.)\n(**Image sequence is according the implementation flow)\n\n###Rendered template from PasswordResetRequestForm form\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/django-reset-password/reset-password.png\">\n\n###Rendered template from PasswordResetRequestForm form with error messages\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/django-reset-password/invalid-username.png\">\n\n\n###Rendered template of login form with sent email confirmation message\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/django-reset-password/reset-mail-sent.png\">\n\n###Sent Email look\n<img src=\"https://github.com/ruddra/blog-images/raw/master/django-reset-password/reset-email.png\">\n\n\n##Implemetation of clicking the reset url and entering new password for reset completation.\n\nFirst, lets write a <b>form</b> which will have two fields new password and retype password field. \n\n\n    class SetPasswordForm(forms.Form):\n        \"\"\"\n        A form that lets a user change set their password without entering the old\n        password\n        \"\"\"\n        error_messages = {\n            'password_mismatch': (\"The two password fields didn't match.\"),\n            }\n        new_password1 = forms.CharField(label=(\"New password\"),\n                                        widget=forms.PasswordInput)\n        new_password2 = forms.CharField(label=(\"New password confirmation\"),\n                                        widget=forms.PasswordInput)\n\n        def clean_new_password2(self):\n            password1 = self.cleaned_data.get('new_password1')\n            password2 = self.cleaned_data.get('new_password2')\n            if password1 and password2:\n                if password1 != password2:\n                    raise forms.ValidationError(\n                        self.error_messages['password_mismatch'],\n                        code='password_mismatch',\n                        )\n            return password2\n\n\nIt will take two password input and verify if they match, if those inputs match(in clean method), it will return password. Now using that form, we are going to write a <b>view</b>(reference for implementation:(<a href=\"https://github.com/django/django/blob/731f313d604a6cc141f36d8a1ba9a75790c70154/django/contrib/auth/views.py#L192\">source</a>)).\n\n\n    class PasswordResetConfirmView(FormView):\n        template_name = \"account/test_template.html\"\n        success_url = '/admin/'\n        form_class = SetPasswordForm\n\n        def post(self, request, uidb64=None, token=None, *arg, **kwargs):\n            \"\"\"\n            View that checks the hash in a password reset link and presents a\n            form for entering a new password.\n            \"\"\"\n            UserModel = get_user_model()\n            form = self.form_class(request.POST)\n            assert uidb64 is not None and token is not None  # checked by URLconf\n            try:\n                uid = urlsafe_base64_decode(uidb64)\n                user = UserModel._default_manager.get(pk=uid)\n            except (TypeError, ValueError, OverflowError, UserModel.DoesNotExist):\n                user = None\n        \n            if user is not None and default_token_generator.check_token(user, token):\n                if form.is_valid():\n                    new_password= form.cleaned_data['new_password2']\n                    user.set_password(new_password)\n                    user.save()\n                    messages.success(request, 'Password has been reset.')\n                    return self.form_valid(form)\n                else:\n                    messages.error(request, 'Password reset has not been unsuccessful.')\n                    return self.form_invalid(form)\n            else:\n                messages.error(request,'The reset password link is no longer valid.')\n                return self.form_invalid(form)\n\n\nURL for this view:\n\n\n    urlpatterns += patterns('',\n                           url(r'^admin/', include(admin.site.urls)),\n                           url(r'^account/reset_password_confirm/(?P<uidb64>[0-9A-Za-z]+)-(?P<token>.+)/$', PasswordResetConfirmView.as_view(),name='reset_password_confirm'),\n                       )\n\n\n\nWell **PasswordResetConfirmView** takes two parameter from urls, uidb64 and token, those were sent within email generated by **ResetPasswordRequestView**. We got user id hence the user by decoding **uid64** by using **urlsafe__base64__decode**, and function **default___token___generator.check__token** checks the token against the user. If they are valid and the form is valid, we set new password for the user using **.set__password('password')** function. If they are not valid, it will show an error message saying the url is no longer valid.\n\nMore screenshots:(sequencial to implementation)\n###Rendered template for SetPasswordForm form\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/django-reset-password/reset-password-prompt.png\">\n\n### Reset successful\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/django-reset-password/reset-success.png\">\n\nThus you implement your very own forgot or reset the password.\n\n<h3><b>For full project/implementation, please check/fork this <a href=\"https://github.com/skyrudy/django-reset-password/tree/master\">repository</a>. This code has been tested for Python3 and django 1.7/1.10 .</b> </h3>", "id": "12", "title": "Implementation of 'Forgot/Reset Password' feature in Django"}, {"published_at": "2427-02-13 00:16:55", "markdown": "I am going to share some useful **Django** tools/functions which are very useful(were for me atleast) to get things done.\n\n###Return any model class and its properties\n\nThis method will return any model class if you have the name of the class. \n\n\n    from django.db import models\n\n    def get_model_description(model_name=None, return_property_list=True):\n        for item in models.get_models(include_auto_created=True):\n            if item.__name__ == model_name:\n                if return_property_list is True:\n                    return item.get_trigger_properties()\n                else:\n                    return item\n        return []\n\n\n\nFor usage, let us think of an example. Let us think, we have a class name 'X', we will get the class instance using it like this:\n\n\n    from usefultools import get_model_descriptor\n\n    model_x = get_model_descriptor(model_name='X')   #will get class\n    model_x_objects = get_model_descriptor(model_name='X').objects.all() #will get all the objects of this class\n\n\n\nAnd for its property:\n\n    from usefultools import get_model_descriptor\n\n    model_x = get_model_descriptor(model_name='X', return_property_list=True)   #will get a list of properties like ['a_property','b_property']\n\n###Distance Calculator\n\nIf you input latitude and longitude of two places, this function will return the distance in between them. Got help from here: http://code.activestate.com/recipes/576779-calculating-distance-between-two-geographic-points/\n\n\n\n    import math\n\n    def distance_calculator(lat1, long1, lat2, long2):\n\n        lat1, long1, lat2, long2 = float(lat1), float(long1), float(lat2), float(long2)\n\n        degrees_to_radians = math.pi/180.0\n\n        phi1 = (90.0 - lat1)*degrees_to_radians\n        phi2 = (90.0 - lat2)*degrees_to_radians\n\n\n        theta1 = long1*degrees_to_radians\n        theta2 = long2*degrees_to_radians\n\n        cos = (math.sin(phi1)*math.sin(phi2)*math.cos(theta1 - theta2) +\n               math.cos(phi1)*math.cos(phi2))\n        arc = math.acos( cos )\n        distance = arc*6378.1\n          \n        return distance\n\n\nIt will return the distance in KM.\n\n###Dynamic Relational Operations\n\nSuppose we have a sentence like: `'5 is greater than 9'` and check if its true. We could use `eval` to dynamically converty string to python but its highly not recommended. So I tried like this:\n\n\n    def calculate_relational_operation(lhs, rhs, operator):\n        get_type = type(lhs).__name__\n        if get_type == 'str':\n            rhs = str(rhs)\n        elif get_type == 'float':\n            rhs = float(rhs)\n        elif get_type == 'int':\n            rhs = int(rhs)\n\n        if operator == \"==\":\n            if lhs == rhs:\n                return True\n            return False\n        elif operator == \"!=\":\n            if lhs != rhs:\n                    return True\n            return False\n        elif operator == \">\":\n            if lhs > rhs:\n                    return True\n            return False\n        elif operator == \"<\":\n            if lhs < rhs:\n                    return True\n            return False\n        elif operator == \">=\":\n            if lhs >= rhs:\n                return True\n            return False\n        elif operator == \"<=\":\n            if lhs == rhs:\n                    return True\n            return False\n        elif operator == \"Is\":\n            if lhs is rhs:\n                return True\n            return False\n        return False\n\nIt will return **True** or **False** depending on the statement/input.\n\n\n###Get Week List\n\nIt will return all the weeks list from last 1 year (extendable).\n\n    from isoweek import Week\n\n    def generate_week():\n        max_week = datetime.datetime.combine(Week.thisweek().thursday(), datetime.time(0,0))\n        min_week = max_week - datetime.timedelta(days=365)\n        _weeks = list()\n        while True:\n            _weeks.append('Week'+str(max_week.isocalendar()[1])+ ' ' +str(max_week.isocalendar()[0])))\n            max_week -= datetime.timedelta(days=7)\n            if max_week <= min_week:\n            break\n\n        return _weeks\n\n    #Output>> ['Week2 2015', 'Week1 2015', 'Week52 2014' ....]\n\n\n###Get Month List\n\nIt will return last 12 month's year and month number. Constructed using this SO answer: http://stackoverflow.com/a/6576603/2696165\n\n\n    x = 12\n    now = time.localtime()\n    print([time.localtime(time.mktime((now.tm_year, now.tm_mon - n, 1, 0, 0, 0, 0, 0, 0)))[:2] for n in range(x)])\n\n    #Output>> [(2015, 2), (2015, 1), (2014, 12), (2014, 11), (2014, 10), (2014, 9), (2014, 8), (2014, 7), (2014, 6), (2014, 5), (2014, 4), (2014, 3)]\n", "id": "13", "title": "Some Useful Tools/Function for Django"}, {"published_at": "2427-02-13 02:24:48", "markdown": "I think, Pycharm is <b>THE</b> best IDE for developing python. But unfortunately, the professional edition is not free. But community edition is good enough for doing debugging, integrating GIT etc.<!-- more -->\n\nNormally its easy to use the community edition for django and tornado's debugging/running if you know how to configure.\n\n###Django\nFor django's configuration, there is 5 easy steps: \n\n<b>First:</b> Go to edit configuration and click on it(like the below pictures).<br/>\n<img src=\"https://github.com/ruddra/blog-images/raw/master/blog_pycharm_conf/11.jpg\">\n<br/>\n<img src=\"https://github.com/ruddra/blog-images/raw/master/blog_pycharm_conf/22.jpg\">\n<br/>\n<b>Second:</b> Click on the `(+)` mark in top-left corner and add python configuration.<br/>\n<img src=\"https://github.com/ruddra/blog-images/raw/master/blog_pycharm_conf/33.jpg\">\n<br/>\n<img src=\"https://github.com/ruddra/blog-images/raw/master/blog_pycharm_conf/66.jpg\">\n<br/>\n<b>Third:</b> Click on the **Script**, and for django select the **manage.py** which resides on the project directory.<br/>\n<img src=\"https://github.com/ruddra/blog-images/raw/master/blog_pycharm_conf/44.jpg\">\n<br/>\n<b>Fourth:</b> Add `runserver` as Scripts parameter or any other django commands.<br/>\n<img src=\"https://github.com/ruddra/blog-images/raw/master/blog_pycharm_conf/55.jpg\">\n<br/>\n<b>Fifth:</b> Click Apply and if your python interpreter is correctly configured, then clicking on the run command should run the project, and debugging will work as well.<br/>\n<img src=\"https://github.com/ruddra/blog-images/raw/master/blog_pycharm_conf/77.jpg\">\n\n###Tornado\n\nThere is only 1 Step:\n\nJust follow the first and second step from above configuration and click the *.py file you want to run for tornado project in the **Script**, i.e. this file should contain lines like below:\n\n\n    if __name__ == \"__main__\":\n        application.listen(8888)\n        tornado.ioloop.IOLoop.current().start()\n\nAnd save and run.\n\n###Pycharm 2016\nIn 2016 edition, to add an existing virtual environment to the list of available interpreters\n\n1. In the Project Interpreter page, click <img src=\"https://github.com/ruddra/blog-images/raw/master/E7nvm.png\"> icon.\n\n2. In the drop-down list, choose **Add local**.\n<img src=\"https://github.com/ruddra/blog-images/raw/master/I226A.png\">\n\n3. In the Select Python Interpreter dialog box that opens, choose the desired Python executable, located inside the virtual environment folder, and click OK.\n\nGo to this <a shrefrc=\"https://www.jetbrains.com/help/pycharm/2016.1/adding-existing-virtual-environment.html\">link</a> for more information.", "id": "14", "title": "How to configure Django/Tornado in PyCharm Community Edition"}, {"published_at": "2427-02-13 02:57:11", "markdown": "Here I am going to write a dynamic filter. This filter is made for python 3. It will take query or model class and filter condtion as input, It will return filtered query based on those filter condition.<!--more-->\n\nThis is constructed using this <a href=\"http://stackoverflow.com/questions/14845196/dynamically-constructing-filters-in-sqlalchemy\">SO</a> answer.\n\n###Function:\n\n    class DynamicFilter(ModelHelper):\n\n\n        def __init__(self, query=None, model_class=None, filter_condition=None):\n            super().__init__(*args, **kwargs)\n            self.query = query\n            self.model_class = model_class\n            self.filter_condition = filter_condition\n\n\n        def get_query(self):\n            '''\n            Returns query with all the objects\n            :return:\n            '''\n            if not self.query:\n                self.query = self.session.query(self.model_class)\n            return self.query\n\n\n        def filter_query(self, query, filter_condition):\n            '''\n            Return filtered queryset based on condition.\n            :param query: takes query\n            :param filter_condition: Its a list, ie: [(key,operator,value)]\n            operator list:\n                eq for ==\n                lt for <\n                ge for >=\n                in for in_\n                like for like\n                value could be list or a string\n            :return: queryset\n\n            '''\n\n            if query is None:\n                query = self.get_query()\n            model_class = self.get_model_class()  # returns the query's Model\n            for raw in filter_condition:\n                try:\n                    key, op, value = raw\n                except ValueError:\n                    raise Exception('Invalid filter: %s' % raw)\n                column = getattr(model_class, key, None)\n                if not column:\n                    raise Exception('Invalid filter column: %s' % key)\n                if op == 'in':\n                    if isinstance(value, list):\n                        filt = column.in_(value)\n                    else:\n                        filt = column.in_(value.split(','))\n                else:\n                    try:\n                        attr = list(filter(\n                            lambda e: hasattr(column, e % op),\n                            ['%s', '%s_', '__%s__']\n                        ))[0] % op\n                    except IndexError:\n                        raise Exception('Invalid filter operator: %s' % op)\n                    if value == 'null':\n                        value = None\n                    filt = getattr(column, attr)(value)\n                query = query.filter(filt)\n            return query\n\n\n        def return_query(self):\n            return self.filter_query(self.get_query(), self.filter_condition)\n\n###Usage:\n\n    _filter_condition = [('has_attribute', 'eq', 'attribute_value')]\n\n    dynamic_filtered_query_class = DynamicFilter(query=None, model_class=models.user.User,\n                                      filter_condition=_filter_condition,\n                                      )\n    dynamic_filtered_query = dynamic_filtered_query_class.return_query()\n\n\n\"model_class\" is the model class you want to run the filter upon.\n\n\"filter_condition\" the conditon you want to implement here. This is based on the following operator list:\n\n        eq for ==\n        lt for <\n        ge for >=\n        in for in_\n        like for like\n        value could be list or a string\n", "id": "15", "title": "Dynamically constructing filters based on string input using SQLAlchemy"}, {"published_at": "2427-02-13 04:24:03", "markdown": "<a href=\"https://django-tables2.readthedocs.org/en/latest/\">Django Tables2</a> is a package which displays table directly from queryset. It shows column header based on object's attribute's name. But if someone wants to override it, how can he/she do that? Here is a easy solution.<!--more-->\n\nSuppose we have a model class like this:\n\n\n    class SomeModel(models.Model):\n       somevalue = models.CharField()\n\nAnd we want to show table column **somevalue** to **overridenvalue** \n##Table Class:\n\n\tclass SomeTable(tables.Table):\n\t    def __init__(self, *args, _overriden_value=\"\",**kwargs):\n\t        super().__init__(*args, **kwargs)\n\t            \n            self.base_columns['somevalue'].verbose_name = _overriden_value\n\t    class Meta:\n\t         model = models.SomeModel\n\t             fields = '__all__'\n\n\nAnd the Class Based View:\n\n##View Class\n\n\tclass SomeView(ListView):\n\t    def get_context_data(self, **kwargs):\n\t        context = super().get_context_data(**kwargs)\n\t        context['sometable'] = SomeTable(SomeModel.objects.all(), _overriden_value=\"overriden value\")\n\t        return context\n\n\n And template should render that table like this:\n\n    {% load render_table from django_tables2 %}\n    {% render_table sometable %}\n\n\n Thats it, we shall be able to see our override table column header.", "id": "16", "title": "Change Column Header Dynamically in Django Tables2"}, {"published_at": "2427-02-13 06:52:47", "markdown": "\"Making a blog using django\" is probably the most made tutorial of Django. This post is no different. But I made this in my own way using some of django's built-in  features so that less coding is required and making it more understandable with minimum packages to use. \n\n<blockquote>\nTo view the working source of this tutorial, check here at: <a href=\"https://github.com/ruddra/myblog\">https://github.com/ruddra/myblog</a>\n</blockquote>\n\nBefore jumping to the main event, see if you have these installed in your pc:\n\n    1. Python 3 installed in the computer. (Or python 2.7 if you prefer)\n\n    2. Django 1.7 installed in the computer.\n\nDjango appears to be a MVC framework, but instead of using the name 'Controller', we call it as 'View' and 'View' as 'Template', Also Django is not a CMS. It\u2019s a Web framework; it\u2019s a programming tool that let\u2019s you build Web sites. Check here for details: <a href=\"https://docs.djangoproject.com/en/dev/faq/general\">SOURCE</a>.\n\nSo as we stated before, django appears to be a MVC framework. MVC is a framework for building web applications using a MVC (Model View Controller) design:\n\n    1. The Model represents the application core (for instance a list of database records).\n\n    2. The View displays the data (the database records).(Here it is called \"Template\")\n\n    3. The Controller handles the input (to the database records).(Here it is called \"View\")\n    **(copied from here http://www.w3schools.com/aspnet/mvc_intro.asp)\n\nDjango manipulates data in the database using ORM(Object Relational Model). ORM saves you a lot of time by making the structure of the database, running CRUD(Create Read Update Delete) operations etc. Django ORM builds the structure of the database using the structure of the model. It means, the way you define the model, the way your database structure will be. A model is the single, definitive source of data about your data. It contains the essential fields and behaviors of the data you\u2019re storing. Generally, each model maps to a single database table(<a href=\"https://docs.djangoproject.com/en/dev/topics/db/\">more</a>).\n\nNow let\u2019s start a project named **myproject** in desired directory using this command: `django-admin.py startproject myproject`. Then, create an app inside the myproject directory using `python manage.py startapp myblog`. So the structure should look like this:\n\n    myproject/\n        manage.py\n        myproject/\n            __init__.py\n            settings.py\n            urls.py\n            wsgi.py\n\n        myblog/\n            __init__.py\n            admin.py\n            migrations/\n                __init__.py\n            models.py\n            tests.py\n            views.py\n\nThis reusable app is going to be used for making the blog. More about <a href=\"https://docs.djangoproject.com/en/1.7/intro/reusable-apps/\">reusable apps</a>. \n\nAppend 'myblog' to **myproject>myproject>settings.py**'s INSTALLED_APP like: \n\n    INSTALLED_APPS += (\n        'myblog',\n    )\n\nNow we start by making a blog by making models. In this project, we are going to display Title, Body, Tags in each post. So for each content in a post, database's table is going to need a field. So in our model, we are going to add those fields to **myproject>myblog>models.py** like:\n\n\tfrom django.db import models\n\n\tclass Tag(models.Model):\n\t    name = models.CharField(max_length=255)\n\t    description = models.CharField(max_length=255, null=True, default='')\n\n\t    def __str__(self):\n\t        return self.name\n\n\n\tclass MyBlog(models.Model):\n\t    title = models.CharField(max_length=255)\n\t    body = models.CharField(max_length=20000)\n\t    tags = models.ManyToManyField(Tag)\n\n\t    def __str__(self):\n\t        return self.title\n\nThe reason for making these structure is that:\n\n+ <b>title:</b> It is a <a href=\"https://docs.djangoproject.com/en/1.7/ref/models/fields/#django.db.models.CharField\">CharField</a>(Character Field) which can take any kind of input.\n\n+ <b>body:</b> It is a <a href=\"https://docs.djangoproject.com/en/1.7/ref/models/fields/#django.db.models.CharField\">CharField</a>(Character Field) which can take any kind of input.\n\n+ <b>tags:</b> A <a href=\"https://docs.djangoproject.com/en/1.7/ref/models/fields/#django.db.models.ManyToManyField\">ManyToMany</a> relation with Model Tag, because a blog can be related to multiple tags simillarly a tag can be used to different blogs, hence many to many relation.\n\nThe model class **Tag** is going to be used for making/displaying tags. Now we have made model for blog, need to use ORM for making Database structure and add aditional data(Why migration is necessary? See <a href=\"https://docs.djangoproject.com/en/1.7/topics/migrations/\">here</a>. So for that, go to **myproject** directory where manage.py resides and run:\n\n\n    $python manage.py makemigrations\n\n    $python manage.py migrate\n\n    $ python manage.py createsuperuser --username=admin --email=me@ruddra.com\n    #it will ask for setting a password\n\n    $python manage.py runserver\n    # for running the server\n\n\nThe third command for making a superuser in the system. The fourth command will run your project in this url: 127.0.0.1:8000(if you don't provide any specific ip/port). Or you can run like this `python manage.py runserver 0.0.0.0:8000` and it will make your project run in 0.0.0.0:8000 and this is accessible from browser. The webpage will look like this when the project runs successfully:\n\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/myblog/it_worked.png\">\n\nSo you have successfully ran the django site.\n\nNow the database has been made and superuser has been created, so we go the next step, creating blogs. We are going to use django's one of the most powerful and popular feature, django's admin site. For making admin site visible and accessible, you need to add this lines to your urls.py (**myproject>myproject>urls.py**):\n\n\tfrom django.conf.urls import patterns, include, url\n\tfrom django.contrib import admin\n\tadmin.autodiscover() #this line is for making model visible in admin site\n\n\n\turlpatterns = patterns('',\n\n\t    url(r'^admin/', include(admin.site.urls), name='admin-site'),\n\n\t)\n\nThis lines will let you access the django's admin site using this url: 127.0.0.1:8000/admin (if you are running this project in localhost).\n\nNow we need to modify the **admin.py** in *myblog*'s directory to register the app to admin site.\n\n\t# Location myproject>myblog>admin.py\n\t# Register your models here.\n\n\tfrom django.contrib import admin\n\tfrom django import forms\n\n\tfrom myblog.models import MyBlog, Tag\n\n\tadmin.site.register(MyBlog)\n\tadmin.site.register(Tag)\n\nNow your admin site will look like this:\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/myblog/admin_init.png\">\n\nSo up-to admin site, the making of blog is complete. Next part will be provided in next post. Cheers!!\n\n\n\n\n\n\n\n\n\n\n", "id": "17", "title": "Make a Blog using Django Part 1"}, {"published_at": "2427-02-13 08:41:46", "markdown": "From <a href=\"/2015/09/18/make-a-blog-using-django-part-1-2/\">previous post</a>, you have configured and ran django, also added admin site to the django.\n\n<blockquote>\nTo view the working source of this tutorial, check here at: <a href=\"https://github.com/ruddra/myblog\">https://github.com/ruddra/myblog</a>\n</blockquote>\n\nNow click on the **myblog** section and click `add` to add new blog.\nYou can create new tags using Tags section of the admin page or clicking the `(+)` button right beside the Tags section on the new blog creation page, marked with blue circle in the previous image. After successfully adding a new blog, you can see it in list view page.\n\nCreating new tags is easy, just click on the **Tags** section in the admin page and press `add tags` button.\n\nNow you have created new blogs and tags. Its time for showing them in templates.\n\nFor making data visible in templates, you need to use views to send data to them. let\u2019s use <a href=\"https://docs.djangoproject.com/en/1.7/topics/class-based-views/\">Class Based View(CBV)</a> for that. <a href=\"https://docs.djangoproject.com/en/1.7/ref/class-based-views/generic-display/#listview\">ListView</a> is most appropriate for viewing all blogs in one page as it renders a page representing a list of objects. You can directly use this generic CBV in urls like:\n\n\turlpatterns = patterns('',\n\t    url(r'^admin/', include(admin.site.urls), name='admin-site'),\n\t    url(r'^$', ListView.as_view(model = MyBlog, template_name = 'blog_list.html'), name='blog_list'),\n\t    )\n\nHere, you need to create a template as well to view the data sent from this view:\n\n\t<ul>\n\t    {% for blog in object_list %}\n\t        <li> {{ blog.title }} <br/>\n\t        <p> {{ blog.body }} </p>\n\t    {% endfor %}\n\t</ul>\n\nSo now if you go to URL: 127.0.0.1:8000, you will see a list of Blogs in there.\n\nVoila!! You can see the posts you are creating in admin site on this page.\n\nNow, for accessing each blog post separately, you can use <a href=\"https://docs.djangoproject.com/en/1.7/topics/class-based-views/\">Class Based View (CBV)</a> for that. You can use <a href=\"https://docs.djangoproject.com/en/1.7/ref/class-based-views/generic-display/#detailview\">DetailView</a> for viewing content of one myblog object. For that, you can directly use it in urls like:\n\n\t# ------------- Models ---------------\n\tfrom myblog.models import Tag, MyBlog\n\t# ------------- Generic Views --------\n\tfrom django.views.generic.list import ListView\n\tfrom django.views.generic.detail import DetailView\n\n\n\turlpatterns = patterns('',\n\t    url(r'^admin/', include(admin.site.urls), name='admin-site'),\n\t    url(r'^$', ListView.as_view(model = MyBlog, template_name = 'blog_list.html'), name='blog_list'),\n\t    url(r'^details/(?P<pk>[0-9]+)/', DetailView.as_view(model = MyBlog, template_name = 'blog_details.html'), name='blog_details'),\n\t    # Why naming the urls? Check below for usage of named urls\n\t    )\n\n\n    <h2>{{ object.title }}</h2>\n    <p>{{ object.body }}</p>\n\n    <b>Tags:</b>\n        <p>\n        {% for item in object.tags.all %}\n            {{ item }}\n        {% endfor %}\n        </p>\n\nBlog details can visible to this url: 127.0.0.1:8000/details/1/ . There you should see the details of the Blog you have written before.\n\nNow you can see all the posts and tags separately. Will do some tune-ups in next post. Cheers!!!\n\n\n", "id": "18", "title": "Make a Blog using Django Part 2"}, {"published_at": "2430-01-26 16:44:28", "markdown": "Today I am going to share how to use <a href=\"scrapy.org\">Scrapy</a> and <a href=\"https://www.djangoproject.com/\">Django</a> together to crawl to a website and store scrapped data to Database using Django.\n\nFirst, let us build a Django application using the following commands.\n\n    pip install django==1.7\n    django-admin.py startproject example_project\n    cd example_project\n\nInside the `example_project` directory, we will create a django app named `app`:\n\n    python manage.py startapp app\n\nThen, we will update the `models.py` like this:\n\n    from django.db import models\n\n    class ExampleDotCom(models.Model):\n        title = models.CharField(max_length=255)\n        description = models.CharField(max_length=255)\n\n        def __str__(self):\n            return self.title\n\nNow we shall update the `admin.py` inside the `app` directory:\n\n    from django.contrib import admin\n    from app.models import ExampleDotCom\n    \n    admin.site.register(ExampleDotCom)\n\nUpdate `INSTALLED_APPS` of `settings.py` like:\n   \n    INSTALLED_APPS += ('app',)\n\nNow, we will run the following commands in project directory:\n\n    python manage.py makemigrations\n    python manage.py migrate\n    python manage.py createsuperuser\n\nThe last command will prompt to create a super user for the application. Now we will run the following command:\n\n    python manage.py runserver\n\nIt will start the django application.\n\nDjango part is complete for now. Lets start the **scrapy** project.\n\nIn separate directory, we will create a scrapy project using the following commands:\n\n    pip install Scrapy==1.0.3\n    scrapy startproject example_bot\n\nTo use with Django application from scrapy application, we shall update its `settings.py` inside `example_bot` project directory:\n\n    import os\n    import sys\n\n    DJANGO_PROJECT_PATH = 'YOUR/PATH/TO/DJANGO/PROJECT'\n    DJANGO_SETTINGS_MODULE = 'example_project.settings'\n    \n    sys.path.insert(0, DJANGO_PROJECT_PATH)\n    os.environ['DJANGO_SETTINGS_MODULE'] = DJANGO_SETTINGS_MODULE\n    BOT_NAME = 'example_bot'\n    \n    SPIDER_MODULES = ['example_bot.spiders']\n    \nTo connect with django model, we need to install <a href=\"http://doc.scrapy.org/en/0.24/topics/djangoitem.html\">DjangoItem</a> like this:\n\n    pip install scrapy-djangoitem==1.0.0\n\nInside `example_bot` directory, we will update the `items.py` file like this:\n\n    from scrapy_djangoitem import DjangoItem\n    from app.models import ExampleDotCom\n\n    class ExampleDotComItem(DjangoItem):\n        django_model = ExampleDotCom\n\nNow we will create a crawl spider named `example.py` inside `spiders` directory:\n\n    from scrapy.spiders import BaseSpider\n    from example_bot.items import ExampleDotComItem\n    \n    class ExampleSpider(BaseSpider):\n        name = \"example\"\n        allowed_domains = [\"example.com\"]\n        start_urls = ['http://www.example.com/']\n    \n        def parse(self, response):\n             title = response.xpath('//title/text()').extract()[0]\n             description = response.xpath('//body/div/p/text()').extract()[0]\n             return ExampleDotComItem(title=title, description=description)\n\nNow we shall create an pipeline class like this inside `pipelines.py`:\n\n    class ExPipeline(object):\n        def process_item(self, item, spider):\n            item.save()\n            return item\n\nNow we need to update the `settings.py` with this:\n\n    ITEM_PIPELINES = {\n        'example_bot.pipelines.ExPipeline': 1000,\n    }\n\nProject structure will be like this:\n\n\n    \u251c\u2500\u2500 django1.7+scrapy\n    \u2502   \u251c\u2500\u2500 example_bot\n    \u2502   \u2502   \u251c\u2500\u2500 __init__.py\n    \u2502   \u2502   \u251c\u2500\u2500 items.py\n    \u2502   \u2502   \u251c\u2500\u2500 pipelines.py\n    \u2502   \u2502   \u251c\u2500\u2500 settings.py\n    \u2502   \u2502   \u2514\u2500\u2500 spiders\n    \u2502   \u2502       \u251c\u2500\u2500 __init__.py\n    \u2502   \u2502       \u2514\u2500\u2500 example.py \n    \u2502   \u2514\u2500\u2500 scrapy.cfg\n    \u2514\u2500\u2500 example_project\n        \u251c\u2500\u2500 manage.py\n        \u251c\u2500\u2500 app\n        \u2502   \u251c\u2500\u2500 __init__.py\n        \u2502   \u251c\u2500\u2500 models.py\n        \u2502   \u251c\u2500\u2500 admin.py\n        \u2502   \u2514\u2500\u2500 views.py\n        \u2514\u2500\u2500 example_project\n            \u251c\u2500\u2500 __init__.py\n            \u251c\u2500\u2500 settings.py\n            \u2514\u2500\u2500 urls.py\n\nNow we shall run the application using the following command:\n\n    scrapy crawl example\n\nNow let us return to the running django application. If everything above is done correctly, then we shall see an object of ExampleDotCom class has been created like the below screenshot in this url `http://localhost:8000/admin/app/exampledotcom/`:\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/scrap_django1.png\" alt=\"All Objects\" height=\"200\">\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/scrapy_django2.png\" alt=\"Single Object\" height=\"200\">\n\n\nThats all. Up and running django 1.7 + Scrapy project.\n\n**Drawbacks:** Only implemented using django 1.7\n\n**Source:**  https://github.com/ruddra/django1.7-scrapy1.0.3\n\nGot help and clues from this <a href=\"http://stackoverflow.com/questions/19068308/access-django-models-with-scrapy-defining-path-to-django-project\">stackoverflow</a> link.\n", "id": "19", "title": "Django 1.7 + Scrapy"}, {"published_at": "2430-04-07 17:54:50", "markdown": "In this blog, I am going to show how to develop an application by which we can make **.csv** files from MySQL database using Python.\n\nNow, let us start by getting data from Database. Lets say we have a DB names `csv_test` and it contains a table named `test` with fields `id` and `name`, and for testing purpose let us have some values inserted into it like this:\n    \n    +------+--------+\n    | id   | name   |\n    +------+--------+\n    |    1 | test_1 |\n    |    2 | test_2 |\n    |    3 | test_3 |\n    +------+--------+\n\nNow, to get all data from this table, the SQL command should be: \n\n    SELECT * FROM csv_test.test;\n\nWe shall run this vary command using python like this:\n\n    import subprocess\n\n    try:\n        sql_cmd = \"mysql -uroot -proot -e SELECT * FROM csv_test.test;\"\n        results = subprocess.check_output(\n                [sql_cmd], shell=True)\n        print(results)\n    except Exception as e:\n          print(e)\n\nIf we run the above command, we shell find a binary string like this:\n\n    id\tname\n     1\ttest_1\n     2\ttest_2\n     3\ttest_3\n\nActual output will be something like this:\n\n    b'id\\tname\\n1\\t\\test_1\\n2\\ttest_2\\n3\\ttest_3'\n\nNow we will convert this binary string to unicode string by running this command:\n\n    data = results.decode('utf-8')\n\nAnd the `data` will be like this:\n\n    'id\\tname\\n1\\t\\test_1\\n2\\ttest_2\\n3\\ttest_3'\n\nSo, now we have the MySQL data as string. Now we shall start making **.csv** file out of it.\n\nFirst, lets make an empty **.csv** file, ie:\n\n    filename = 'report_{0}.csv'.format(datetime.datetime.now().strftime('%d-%m-%Y:%H:%M'))\n    csv_out = open(filename, 'w')\n\nFrom the `data` string, we will start making **.csv** file's contents. Let us split the string in new lines(`\\n`) and loop through that list, also replace tabs(`\\t`) with comma(`,`):\n\n\n    csv_data = ''\n    for item in data.split(`\\n`):\n        csv_data += '{0}\\r\\n'.format(item.replace('\\t', ','))\n\n\nNow we write that `csv_data` variable to `csv_out`(empty **.csv** file) like this:\n\n    csv_out.write(csv_data)\n    csv_out.close()\n\nThats it, our work is done. We shall see a **.csv** file named `REPORT_DD-MM-YYYY:HH:MM:SS.csv` in the project directory.\n\n**Special Thanks** to this post:  https://redmoses.me/flask-and-shell/ about using MySQL and Flask togather\n\n**Source** is here: https://github.com/ruddra/mysql-python-csv\n", "id": "20", "title": "Make .CSV file using MySQL and Python"}, {"published_at": "2430-09-12 06:39:41", "markdown": "Today we are going to see how make OSX notifications from RSS Feed of any website using Python.\n\nSo first of all, let us see how to make a simple notification. We are going to use <a href=\"https://en.wikipedia.org/wiki/AppleScript\">AppleScript</a> for this.\nGo to terminal and Type:\n\n    >>osascript -e 'display notification \"Lorem ipsum dolor sit amet\" with title \"Title\"'\n\nWe shall see a notification popping up in right up corner like this: \n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/notification_SS.png\">\n\nNow, we will use this command to pop up notifications using python from rss feeds.\n\nNow, we are going to use <a href=\"https://pypi.python.org/pypi/feedparser\">feedparser</a> library to get feed from a url. For example:\n\n    import feedparser \n    feeds = feedparser.parse('https://feedity.com/ruddra-com/VFZQWlFU.rss')  \n\n    print([(x.title, x.id) for x in feeds.entries])\n\n\nIt will return a list of tuples containing urls and titles from the feed.\n\nNow we will make an infinite loop and inside the loop we will continuously call the rss feed (will also pause for few moments, no worries) and show notifications:\n\n\n    while True:\n        d = feedparser.parse(rss_url)\n        for ds in d.entries:\n           print (d.id, d.title)\n           time.sleep(5)\n\nNow lets build the command for applescript which will put pop ups.\n\n    apple_cmd = \"osascript -e '{0}'\"\n\n    for ds in d.entries:\n        base_cmd = 'display notification \"{0}\" with title \"{1}\"'.format(ds.title, \"Foobar\")\n        apple_cmd.format(base_cmd)\n\nThats all we need. Now if we print the `apple_cmd`, we shall see commands like this:\n\n    osascript -e 'display notification \"Foobar Title\" with title \"Foobar\"'\n\n\nNow using python's `subprocessor` module, we will call these commands:\n\n    import subprocessor\n\n    subprocessor.Popen([apple_cmd], shell=True)\n\n\nAlso there is one more thing, we need to remove duplicate entries from feed, we don't want to see same notifications twice, or see old notifications on and on and on. So, we will check if the feed is updated like this:\n\n    update_time = d.feed.updated\n\nWe will verify if `update_time` is greater than previous iteration in while loop. Also, we will store `feed id` in a list so that we can check if new feed has ids which was already stored in previous iteration.\n\nFinally, the code will look like this:\n\n    last_updated_time = None\n    while True:\n        d = feedparser.parse(rss_url)\n        updated_time = d.feed.updated\n        if updated_time == last_updated_time:\n            print('No new feed')\n        else:\n            last_updated_time = updated_time\n            for entry in d.entries:\n                _id = entry.id\n                if _id in dup_ids:\n                    print('Entry already exists')\n                else:\n                    dup_ids.append(_id)\n                    base_cmd = 'display notification \"{0}\" with title \"{1}\"'.format(_notification, rss_title)\n                    cmd = apple_cmd.format(base_cmd)\n                    subprocess.Popen([cmd], shell=True)\n                time.sleep(5)\n    time.sleep(5)\n\nThats it, we will see popups of new notifications if feed is updated.\n\nThe full working code is here: https://github.com/ruddra/AppleFeedNotifier\n\nCheers!\n", "id": "21", "title": "Make OSX Notifications From RSS Feed Using Python"}, {"published_at": "2436-03-11 19:26:31", "markdown": "This post mainly based on this blog: https://docs.docker.com/compose/django/.\n\nI will be extending this post by serving django+gunicorn using Nginx, also I will using Postgresql docker container to use it as database.\n\nLets not waste time and go to the following steps.\n\n**1.** Let's make an empty directory named **myproject** and add another folder inside name it **src**. **src** should contain the django project. For testing purpose lets put a simple django project inside named **mydjango**.\n\n**2.** Let's create a subdirectory inside **myproject** and name it **config**. Lets put a `requirement.pip` file inside **config** and write these line in it:\n\n```\nDjango==1.10\ngunicorn==19.6.0\npsycopg2==2.6.2\n```\n\n**3.** Now let's make a `Dockerfile` inside the **myproject**. This should contain the following lines:\n\n```\nFROM python:3.5\nENV PYTHONUNBUFFERED 1\nRUN mkdir /config\nADD /config/requirements.pip /config/\nRUN pip install -r /config/requirements.pip\nRUN mkdir /src;\nWORKDIR /src\n```\n\nSo this Dockerfile starts with a Python 3.5 based image. Then the container is modified by adding the `requirement.pip` file in **/config** directory within the container and installing the packages from it.\n\n**4.** Let's create a file called `docker-compose.yml` in **myproject** directory.\n\nThe `docker-compose.yml` file describes the services that make your app. Here we need a web service(Django+Gunicorn), A database(Postgres), and Proxy Server(Nginx). It also describes which Docker images these services will use, how they will link together, any volumes they might need mounted inside the containers. Finally, the `docker-compose.yml` file describes which ports these services expose. See the [docker-compose.yml](https://docs.docker.com/compose/compose-file/) reference for more information on how this file works. Don't forget to add **docker-compose**\n to your python environment by running `pip install docker-compose`.\n\n**5.** Let's add the following configuration to the `docker-compose.yml` file:\n\n```\nversion: '2'\nservices:\n  nginx:\n    image: nginx:latest\n    container_name: ng01\n    ports:\n      - \"8000:8000\"\n    volumes:\n      - ./src:/src\n      - ./config/nginx:/etc/nginx/conf.d\n    depends_on:\n      - web\n  web:\n    build: .\n    container_name: dg01\n    command: bash -c \"python manage.py makemigrations && python manage.py migrate && gunicorn mydjango.wsgi -b 0.0.0.0:8000\"\n    depends_on:\n      - db\n    volumes:\n      - ./src:/src\n    expose:\n      - \"8000\"\n    \n  db:\n    image: postgres:latest\n    container_name: ps01\n```\n\nIt says that there are three services for this project: *nginx, web, db*. nginx depends on web, web depends on db. *db* container uses [postgres's latest image](https://hub.docker.com/_/postgres/) from dockerhub. Default username for *db* is `postgres` and password is `postgres` \n*web* container is build using project's `Dockerfile`. It mounts **src** directory into it and exposes port 8000. `version` is being used for [which format to use to compose](https://medium.com/@giorgioto/docker-compose-yml-from-v1-to-v2-3c0f8bb7a48e#.asnbe1ob5) the docker file.\n\n*nginx* uses [nginx's latest image](https://hub.docker.com/_/nginx/) from dockerhub. This proxy server is accessible from port 8000. It mounts **src** and **config** directory.\n\n**6.** Now let's write a [nginx configuration](http://nginx.org/en/docs/beginners_guide.html) config file named `mydjango.conf` inside **myproject**'s config folder and put it in a subdirectory named **nginx**. \n\n```\nupstream web {\n  ip_hash;\n  server web:8000;\n}\n\n# portal\nserver {\n  location / {\n        proxy_pass http://web/;\n    }\n  listen 8000;\n  server_name localhost;\n}\n```\n\nSo what it does that, nginx acts as a reverse proxy for any connections going to django server and all connections goes through nginx to reach django server.\n\nProject Directory should look like this:\n\n```\n\u2500\u2500 myproject\n    \u251c\u2500\u2500 src\n    \u2502   \u251c\u2500\u2500 mydjango\n    \u2502   \u251c\u2500\u2500 manage.py\n    \u251c\u2500\u2500 config\n    \u2502   \u251c\u2500\u2500 requirements.pip\n    \u2502   \u251c\u2500\u2500 nginx\n    \u2502      \u251c\u2500\u2500 mydjango.conf\n    \u251c\u2500\u2500 Dockerfile\n    \u2514\u2500\u2500 docker-compose.yml\n```\n\n**7.** To communicate from django to postgres, we need to put database configuration in django applications settings file. It should look like this:\n\n```\nDATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.postgresql_psycopg2',\n        'NAME': 'postgres',\n        'USER': 'postgres',\n        'HOST': 'db',\n        'PORT': 5432,\n    }\n} \n\n``` \n**8.** All is done. Now lets run `docker-compose build` in terminal within the project directory. It will build/rebuild(if necessary) all the containers. For first time running the containers, run `docker-compose up -d`. Lets go to browser and type: `localhost:8000`. We should see the django application up and running. \n\n**9.** For stopping the docker, run `docker-compose stop`. Re-running docker, use `docker-compose start`.\n\n**10.** For shell accessing.\n\n```\n#Nginx\ndocker exec -ti nginx bash\n\n#Web\ndocker exec -ti web bash\n\n#Database\ndocker exec -ti db bash\n```\n\nFor logs:\n\n```\n#Nginx\ndocker-compose logs nginx\n#Web\ndocker-compose logs web\n#DB\ndocker-compose logs db\n```\n\nThats it. You can see an working example here in my repo: https://github.com/ruddra/docker-django\n\nAlso another deployment example for Ruby on rails here: https://github.com/ruddra/deploy-notebook\n(Thanks to [Akimul Islam](https://github.com/akimul) for the source)\n\n\n**Cheers!!**\n\n###Update:\nServing django with gunicorn won't allow you to serve static files with it. You need to serve static files seperately. You can follow this post: http://ruddra.com/2016/11/02/serve-static-files-by-nginx-from-django-using-docker/ for how to do serve static files using Nginx from docker.\n\n", "id": "22", "title": "Deploy Django, Gunicorn, NGINX, Postgresql using Docker"}, {"published_at": "2436-07-20 13:35:57", "markdown": "<center> \n\n<strong>YO!</strong>\n \nI am Arnab Kumar Shil(Ruddra), a developer living in Dhaka, Bangladesh.\n\nCurrently I am working as a Software Engineer at [Cefalo Bangladesh Ltd](http://cefalo.com).\n\nI love coding and learning. So I intend to try out stuff which I find interesting.\n\nPython and Javascript are my preferred languages. I have developed apps using frameworks like Django, Tornado, Flask, SQLAlchemy, AngularJs, ReactJs, React Native, Redux etc. I am also into devops stuff as well. Lately, I have tried out Openshift :). Love dockerizing projects.\n\nI am an open source enthusiast. Also, I contribute to StackOverflow and I have more than 6000 reputations.\n\nLove traveling, anime, cycling, ping pong, biking and humour. Ameture Photographer.\n\nEmail me with any query at me@ruddra.com\n\n</center>", "id": "23", "title": "About Me..."}, {"published_at": "2438-05-24 16:14:33", "markdown": "This is more of a followup post of my previous <a href=\"http://ruddra.com/2016/08/14/docker-django-nginx-postgres/\">blog</a>. \n\nBefore I start, I am assuming you have successfully deployed django using docker & nginx, but having some problems serving static files.\n\nNo worries, its easy. Just follow these steps:\n\n**1.** In your django **settings.py** file, add static file directory i.e. `STATIC_ROOT=/static`. So what it will do is, when you run `collectstatic` command(`python manage.py collectstatic`), it will store the static files in your **/static** directory of OS.\n\n**2.** Now in `docker-compose.yml` folder, lets add a configuration like this:\n\n```\nversion: '2'  \nservices:  \n  nginx:\n    image: nginx:latest\n    container_name: NGINXDOCKERNAME\n    ports:\n      - \"8000:8000\"\n    volumes:\n      - ./src:/src\n      - ./config/nginx:/etc/nginx/conf.d\n      - /static:/static  <--- HERE\n    depends_on:\n      - web\n  web:\n    build: .\n    container_name: DJANGOXDOCKERNAME\n    command: bash -c \"python manage.py makemigrations && python manage.py migrate && gunicorn mydjango.wsgi -b 0.0.0.0:8000\"\n    depends_on:\n      - db\n    volumes:\n      - ./src:/src\n      - /static:/static    <---- HERE\n    expose:\n      - \"8000\"\n\n  db:\n    image: postgres:latest\n    container_name: PSQLDOCKERNAME\n\n```\n\nWhat it will do is that, two containers *web* and *nginx* will share a directory named **/static**.\n\n**3.** Now lets add few lines in nginx's config file, i.e `mydjango.conf`: \n\n```\nupstream web {  \n  ip_hash;\n  server web:8000;\n}\n\nserver {\n\n    location /static/ {    \n        autoindex on;    \n        alias /static/; \n    }\n\n    location / {\n        proxy_pass http://web/;\n    }\n    listen 8001;\n    server_name localhost;\n}\n```\nSo what it will do is, any request to url like `yourhost:yourport/static/*` this comes to nginx, it will serve data from `/static` directory.\n\n**4.** Now lets run the following command:\n```\ndocker exec DOCKERNAME /bin/sh -c \"python manage.py collectstatic --noinput\"\n```\nIt will put static files in `/static` directory and thats should do the trick. Whenever you hit url with `/static` will serve static files from that folder. Similarly you can serve media files too.\nCodes have been updated here at: https://github.com/ruddra/docker-django \nCheers!!", "id": "24", "title": "Serve Static Files by Nginx from Django using Docker"}, {"published_at": "2438-09-21 09:42:22", "markdown": "In previous two posts, we have deployed Django with Postgres, Nginx, now its time to do some async stuff using Celery. In this post, I will do the magic tricks first, explain them later.\n\n###Add Celery to Django\n\nTo add celery, we need make a container for celery. We can re-use the `Dockerfile` of django for making celery's container like this:\n```\nFROM python:latest\nENV PYTHONUNBUFFERED 1\n\n#ENV C_FORCE_ROOT true # intentionally kept it commented\n\nENV APP_USER user\nENV APP_ROOT /src\n\nRUN groupadd -r ${APP_USER} \\\n    && useradd -r -m \\\n    --home-dir ${APP_ROOT} \\\n    -s /usr/sbin/nologin \\\n    -g ${APP_USER} ${APP_USER}\n\nWORKDIR ${APP_ROOT}\n\nRUN mkdir /config\nADD config/requirements.txt /config/\nRUN pip install -r /config/requirements.txt\n\nUSER ${APP_USER}\nADD . ${APP_ROOT}\n\n```\n\nNow lets update the `docker-compose.yml` file to link django with celery, also link redis container to celery.\n\n```\nversion: '2'  \nservices:  \n  nginx:\n    image: nginx:latest\n    container_name: nx01\n    ports:\n      - \"8001:8001\"\n    volumes:\n      - ../src:/src\n      - ./static:/static\n      - ./media:/media/\n      - ./config/nginx:/etc/nginx/conf.d\n    depends_on:\n      - web\n  web:\n    build: .\n    container_name: dg01\n    command: gunicorn mydjango.wsgi 0.0.0.0:8000\n\n    depends_on:\n      - db\n    links:\n      - redis\n    volumes:\n      - ../src:/src\n      - ./static:/static\n      - ./media:/media/\n    expose:\n      - \"8001\"\n  db:\n    image: postgres:latest\n    container_name: pq01\n    ports:\n     - \"5432:5432\"\n\n  redis:\n    image: redis:latest\n    container_name: rd01\n    ports:\n     - '6379:6379'\n\n  celery:\n    build: .\n    container_name: cl01\n    command: celery worker --app=app.tasks\n    volumes:\n      - ..:/src\n    links:\n      - db\n      - redis\n```\n\nNow in django project, lets add broker url for celery in `settings.py`:\n\n```\nCELERY_BROKER_URL = 'redis://redis:6379/0'\nCELERY_RESULT_BACKEND = 'redis://redis:6379/0'\n```\n\nIntegration with celery from django is complete. You don't need to read the next section if you already have celery tasks.\n\n###Make a Simple Async Task\nHow to use celery from django? There is an amazing <a href=\"http://docs.celeryproject.org/en/latest/django/first-steps-with-django.html.\">documentation</a> about that on celery's own documentation page.\n\nTo make this post post short, I will not get to details, but do basic stuff for making a simple async task using celery.\n\nLets add a `celery.py` inside **mydjango>mydjango** directory.\n\n```\nfrom __future__ import absolute_import, unicode_literals\nimport os\nfrom celery import Celery\nimport logging\nlogger = logging.getLogger(\"Celery\")\n\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'mydjango.settings')\n\napp = Celery('mydjango')\n\napp.config_from_object('django.conf:settings', namespace='CELERY')\n\napp.autodiscover_tasks()\n\n\n@app.task(bind=True)\ndef debug_task(self):\n    print('Request: {0!r}'.format(self.request))\n\n```\n\nAnd create a new app named `myapp`, add it to django settings: \n```\nINSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n    'myapp.apps.MyappConfig',\n    'celery', # Don't forget to add celery\n]\n```\nNow we need to install `celery` and `redis` by using: \n```\npip install celery\npip install redis\n```\nor we can add them to **config>requirements.pip**.\n\nNow lets add a simple email sending task in **src>mydjango>myapp>tasks.py**\n\n```\nfrom __future__ import absolute_import, unicode_literals\n\nfrom django.conf import settings\nfrom django.core.mail import EmailMultiAlternatives\nfrom mydjango.celery import app\n\n\n@app.task\ndef send_email(recipient_list, subject, body, from_address):\n    if not isinstance(recipient_list, list):\n        recipient_list = [recipient_list]\n    if not from_address:\n        from_address = getattr(settings, 'EMAIL_FROM_ADDRESS')\n\n    msg = EmailMultiAlternatives(subject, body, from_address, recipient_list)\n    msg.send()\n```\nAlso add smtp configuration in your django settings.\n\nThats it, that should do the trick. Now just run `docker-compose build` and `docker-compose run` to make the project running.\n\n###Explanations\n\nIn first step, we have updated `Dockerfile` which was responsible for building django application's environment. \n\n```\nENV APP_USER user\nENV APP_ROOT /src\n\nRUN groupadd -r ${APP_USER} \\\n    && useradd -r -m \\\n    --home-dir ${APP_ROOT} \\\n    -s /usr/sbin/nologin \\\n    -g ${APP_USER} ${APP_USER}\n```\n\nThe above lines have added APP_USER to user group in the environment and `APP_ROOT` will be home directory and `APP_USER` doesn't require login. This step is necessary for Celery.\n\nRest of the file is about creating a directory named `src` and make it working directory. make `config` directory, put `requirements.pip` file in it and install the packages using pip. And Of course, we are pulling from latest python image.\n\nIn `docker-compose.yml`, we have newly added a container named **celery(cl01)**, and it will be built from `Dockerfile` which resides with `docker-compose.yml` in same directory. **redis** container will be linked to **celery**, **redis** can be communicable from port 6379.\n\nNow the new **celery** container will be linked to the old **django** container.\n\ncelery will run this command: `celery worker --app=myapp.tasks`, which will execute tasks within an app named myapp.\n\n###Need proof that this works?\nGo to this github <a href=\"https://github.com/ruddra/docker-django\">link</a> and pull and build. Don't forget to update email configurations inside the settings of django.\n\nCheckout previous posts about docker:\n1. <a href=\"http://ruddra.com/2016/08/14/docker-django-nginx-postgres/\">Deploy Django, Gunicorn, NGINX, Postgresql using Docker</a>\n2. <a href=\"http://ruddra.com/2016/11/02/serve-static-files-by-nginx-from-django-using-docker/\">Serve Static Files by Nginx from Django using Docker</a>\n\n", "id": "25", "title": "Docker: Use Celery in Django(Redis as Broker)"}, {"published_at": "2441-07-08 05:32:12", "markdown": "<a href='https://github.com/ruddra/django-encrypt-file'>Django Encrypt File</a> is a simple Library which can be used to encrypt uploaded files and store them.\n\n###Installation\n\nUse pip to install it:\n```\npip install djangoencryptfile\n```\nOr\n```\npip install https://github.com/ruddra/django-encrypt-file/tarball/0.7\n```\n\n###Basic Usage\n```\nfrom djangoencryptfile import EncryptionService\nfrom django.core.files import File\n\npassword = '1234'\nservice = EncryptionService(raise_exception=False)\n\nopen('readme.md', 'rb') as inputfile:\n    usefile = File(inputfile, name='readme.md')\n    encrypted_file = service.encrypt_file(useFile, password, extension='enc')  # it will save readme.md.enc\n    decrypt_file = service.decrypt_file(encrypted_file, password, extension='.enc') # it will remove .enc extension\n```\n###Using in the View\n```\nfrom django_encrypt_file import EncryptionService, ValidationError\n\n\ndef some_view(request):\n   try:\n       myfile = request.FILES.get('myfile', None)\n       password = request.POST.get('password', None)\n       encrypted_file = EncryptionService().encrypt_file(myfile, password, extension='enc')\n       decrypt_file = service.decrypt_file(encrypted_file, password, extension='enc') # it will remove .enc extension\n   except ValidationError as e:\n       print(e)\n```\n\n###Advance Example(With Models)\n\nModel defination:\n```\nclass MyModel(models.Model):\n    upload_file = models.FileField(\n        upload_to='tuploaded_file/%Y/%m/%d'\n    )\n```\n\nEncrypt View:\n```\nfrom django_encrypt_file import EncryptionService, ValidationError\n\n\ndef encrypt_view(request):\n   try:\n       myfile = request.FILES.get('myfile', None)\n       password = request.POST.get('password', None)\n       encrypted_file = EncryptionService().encrypt_file(myfile, password, extension='enc')\n       mymodel = MyModel.objects.create(uploaded_file=encrypted_file)\n   except ValidationError as e:\n       print(e)\n\n```\n\nDecrypt View:\n```\nfrom django_encrypt_file import EncryptionService, ValidationError\n\n\ndef decrypt_view(request):\n   try:\n       my_object = MyModel.objects.get(pk=1)\n       myfile = my_object.uploaded_file\n       password = request.POST.get('password', None)\n      \n       decrypt_file = service.decrypt_file(encrypted_file, password, extension='enc')\n       my_object.uploaded_file = decrypt_file\n       my_object.save()\n   except ValidationError as e:\n       print(e)\n```\n\n###Notes\nInput file here can be any kind of Django File Object like `models.FileField` or `forms.FileFiled`. `raise_exception = True` will throw ValidationError error which can be imported from `django_encrypt_file import ValidationError`.", "id": "26", "title": "Documentation Of Django Encrypt File"}, {"published_at": "2442-03-13 23:17:25", "markdown": "<dl>\n<dt>PhantomJS is</dt>\n<dd> a headless WebKit scriptable with a JavaScript API. It has fast and native support for various web standards: DOM handling, CSS selector, JSON, Canvas, and SVG.</dd>\n</dl>\n\nAnd \n\n<dl>\n<dt>\nSelenium is\n</dt>\n<dd>\nA portable software-testing framework for web applications. Selenium provides a record/playback tool for authoring tests without the need to learn a test scripting language (Selenium IDE)\n</dd>\n</dl>\n\nUsing the combination of selenium and PhantomJs can give you a way to capture screenshots and use it in your choices.\n\nFor that let's install PhantomJs in your computer.\nFor Ubuntu/Debian platform, you can use like this:\n```\n>sudo apt-get install phantomjs\n        -------- OR --------\n>sudo apt-get update\n>sudo apt-get install build-essential chrpath libssl-dev libxft-dev\n>sudo apt-get install libfreetype6 libfreetype6-dev\n>sudo apt-get install libfontconfig1 libfontconfig1-dev\n>cd ~\n>wget https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-2.1.1-linux-x86_64.tar.bz2\n>sudo tar xvjf phantomjs-2.1.1-linux-x86_64.tar.bz2\n>sudo mv phantomjs-2.1.1-linux-x86_64 /usr/local/share\n>sudo ln -sf /usr/local/share/phantomjs-2.1.1-linux-x86_64/bin/phantomjs /usr/local/bin\n```\nOr use `npm`:\n```\n>npm install phantomjs2\n```\n\nInstall selenium by using `pip install selenium`\n\nLet's go to coding:\n```\nfrom selenium import webdriver  # Import selenium web driver\n\ndriver = webdriver.PhantomJs()  # PhantomJs webdriver\n\ndriver.get('https://google.com')\n\ndriver.save_screenshot('google.png')\n```\n\nDone! your image will be saved as **google.png**.\n\nSuppose you want to store the image in Django ImageFile, you can use the following code:\n\n```\nscreenshot = driver.screenshot_as_base64()  # binary image\n\nmy_model = MyModel()\nmy_model.image_field = ContentFile(screenshot, 'google.png')\nMyModel.save()\n```\n\nThat's all for now.\nCheers!!", "id": "29", "title": "Python: Selenium with PhantomJs to capture Screenshots"}, {"published_at": "2444-08-06 14:42:39", "markdown": "Who hasn't heard PIL? It's an image processing library made by python (Python Image Library). Pillow is an extension of it.\n\nSo installing pillow is really easy:\n>pip install pillow\n\nNow we are going to do some image processing cool stuff:\n\nFirst Load Image:\n\n```\nfrom PIL import Image, ImageOps\n\nimg = Image.open('image.png')\n```\n\n#### Resize Image\nSuppose We want to resize an image and maintain its aspect ratio. Here we need to get the aspect ratio after resizing. Here is a snippet for it:\n\n```\n   def get_resize_image_size(image, baseheight=None):\n        \"\"\"\n        Get resize image size\n        \"\"\"\n        size = 1200, 1200\n        print(\"Getting resize image size\")\n        if not baseheight:\n            baseheight = size[1]\n        hpercent = (baseheight / float(image.size[1]))\n        wsize = int((float(image.size[0]) * float(hpercent)))\n        return wsize, baseheight\n\n```\n**Or** we may want to our desired image size.\n\nAfter we get the desired aspect ratio, now we resize it with the following code:\n\n```\ndef resize_image(img, size=None):\n    \"\"\"\n    Resize Image\n    img: Image file opened by PIL\n    size: if Size not given, it will be \n    calculated \n    \"\"\"\n    print(\"Resizing image\")\n    if not size:\n       size = get_resize_image_size(img)\n    img = img.resize(size, Image.ANTIALIAS)\n    return img\n```\n\n####Crop Image in Box Shape\nWhen we try to crop, we can either give it positions for cropping or we can calculate the points, which will be used in cropping. Suppose we have a random image, but we want to crop it in middle position and we want to crop in such way that, we will only take out 1200x1200 size out of the sample image, the following is the code:\n\n```\n    def crop_position(image):\n        \"\"\"\n        Get Crop Image Positions\n        \"\"\"\n        print(\"Getting Crop Image Positions\")\n        width, height = image.size\n        new_width, new_height = 1200, 1200\n        left = (width - new_width) / 2\n        top = (height - new_height) / 2\n        right = (width + new_width) / 2\n        bottom = (height + new_height) / 2\n        return left, top, right, bottom\n```\nNow we got the position, lets do cropping:\n\n```\ndef crop_image(img, positions=None):\n   \"\"\"\n   Crop Image in Box Shape\n   \"\"\"\n   if not positions:\n       positions = crop_position(img)\n   return img.crop(box=positions)\n```\n\n####Resize Image and Crop in Center to Convert it to a Fixed Size\nLet's take an image in size and convert it to 1200x1200 image:\n\n```\n   def convert_image(pil_image):\n        \"\"\"\n        Resize Image and Crop in Center to Convert it to a Fixed Size\n        \"\"\"\n        try:\n            if pil_image.size == self.size:\n                print(\"Nothing to change, returning image\")\n                return image\n            # Resize to size given in settings\n            pil_image = resize_image(pil_image)\n            # Cropping to adjust size given in settings\n            pil_image = crop_image(pil_image)\n            pil_image.save(path)\n        except (KeyError, Exception) as exp:\n            print(str(exp))\n            raise exp\n```\n\n####Paste Image over Background Image\nThe following code will do the trick:\n\n```\n    def add_overlay_over_background(background_image, overlay_image, offset=(0, 0)):\n        \"\"\"\n        Add overlay image over background image\n        \"\"\"\n        background_image.paste(overlay_image, offset, mask=overlay_image)\n        return background_image\n```\n\n####Draw Text over Image\nFor that, we first we need fonts:\n\n```\n    path = 'path/to/font'\n    def get_font(size):\n        \"\"\"\n        Get Font Object\n        \"\"\"\n        return ImageFont.truetype(path, size=size)\n```\nThen we need to co-ordinates where the texts will be written:\n\nHere are two scenarios:\n\n   1. You provide the exact positions.\n   2. You can provide the height of the text position, we will calculate where the texts will be printed in the image. Here we are assuming that texts will be aligned in middle horizontally. It will be symmetric in perspective middle vertical line.\n\n```\n\n    def process_text_coordination(position, font=None, vertical_only=False, text=None):\n        \"\"\"\n        Process Co-Ordination of the position\n        \"\"\"\n        if vertical_only:\n            # Case Two\n            size = font.getsize(text)\n            width = (self.size[0] - size[0]) / 2\n            return width, position\n       # Case One\n       return position\n\n```\nNow we got everything, so let's do writing text on image:\n\n```\n    def write_text_on_image(image, font, text,position, color, size, vertical_only=False):\n        \"\"\"\n        Write Text over Image\n        \"\"\"\n        draw = ImageDraw.Draw(image)\n        font = get_font(size)\n        position = process_text_coordination(\n            position, font, vertical_only, text\n        )\n        draw.text(position, text, font=font, fill=color)\n        return image\n\n```\nBTW, here color can be hexa value of the color you want to use. For white, you need use: `#fffff`\n\n####Adjast brightness of Images\nLet's lighten or darken image based on amount:\n```\n    def darken_or_lighten_pixels(image, amount=0.5):\n        \"\"\"\n        Enhance Image\n        \"\"\"\n        converter = ImageEnhance.Brightness(image)\n        return converter.enhance(amount)\n\n```\n\n####Adjast color of images\n\nLet's adjust color of image based on amount\n\n```\n    def add_color_saturation(image, amount=0.5):\n        \"\"\"\n        Color saturation\n        \"\"\"\n        converter = ImageEnhance.Color(image)\n        return converter.enhance(amount)\n\n```\n\n####Save PIL Image in Django Models or Serve as Django File\n\nThis code will convert PIL Images to Content file:\n\n```\n    def process_django_file(pil_image, name, format='png'):\n        \"\"\"\n        Process the PIL file to Django File\n        \"\"\"\n        file_object = BytesIO()\n        pil_image.save(file_object, format=format)\n        content = file_object.getvalue()\n        return ContentFile(content, name=name)\n```\n\nAnd saving image will be damn easy:\n\n```\npil_image = Image.open('image.png')\n\ncontent_file = process_django_file(pil_image, name=\"some name\", format='png')\n\nmy_model.image = content_file\nmy_model.save()\n```\n\nAnd many more methods are given in the following Repo:\n\nhttps://github.com/ruddra/play-with-pillow\n\nHope it was helpful. Cheers!!!", "id": "30", "title": "Play With Pillow"}, {"published_at": "2445-06-26 07:26:25", "markdown": "Chrome apps are really handy when you don't want to overhaul your system with apps for every little purpose. Starting those apps at startup can be used instead of manually starting them everytime you want to use them. Like starting the messenger at startup of the system. To do that.\n\n1. First, go to Ubuntu's search menu and search for `startup applications`.\n<img src=\"https://github.com/ruddra/blog-images/raw/master/ubuntu_chrome_app/1.png\">\n2. Then open that application preference and add new startup application. \n<img src=\"https://github.com/ruddra/blog-images/raw/master/ubuntu_chrome_app/3.png\">\n<img src=\"https://github.com/ruddra/blog-images/raw/master/ubuntu_chrome_app/4.jpg\">\n3. Put any name you want in there. Also, in command section, write: \n\n```\ngoogle-chrome --app-id=[app_id]\n```\n\nNow you need to have **app_id** which you can easily find like this:\n\nFor example, we want to add All in One Messenger, and when you look for it in chrome store, the URL will appear like this: https://chrome.google.com/webstore/detail/all-in-one-messenger/lainlkmlgipednloilifbppmhdocjbda?hl=en\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/ubuntu_chrome_app/2.gif\">\n\nSo the `lainlkmlgipednloilifbppmhdocjbda` is the **app_id** here. \n\nFinally, if we want to add this app at startup, first we need to add it to our chrome, then like the previous steps mentioned above, add new startup application with the command: `google-chrome --app-id=lainlkmlgipednloilifbppmhdocjbda`. That should do the trick and you will see all in one messenger starting up whenever you initially login into the system.", "id": "32", "title": "Ubuntu Hacks: Launching Chrome Apps at Startup"}, {"published_at": "2446-04-23 05:18:23", "markdown": "<a href=\"https://code.visualstudio.com/\">VS Code</a> is an editor developed by Microsoft. I have been using this editor for Python development for a few months now. Previously I have been using Pycharm Community Edition for development, but I had to switch to an editor which was less resource consuming than Pycharm, hence I found VS Code. \n\nIt was initially suggested to my by one of my colleagues. My first impression was, what is this? Is it really usable? Is it as bad as Atom?(I have a dreadful experience with Atom, although Atom is maybe as good as VS Code). But instead, I found that it is really useful, user-friendly and has lots of useful features. \n\nLet us check out, how we can use VS Code to develop Production grade Python applications.\n\n### Configuring VS Code:\n#### Configuring Python\nFor using pythonic features, you need to install plugin <a href=\"https://github.com/DonJayamanne/pythonVSCode\">Python VS Code</a>\nTo do that, go to Extensions Section of VS Code(marked blue in the image given below), in search section, type python; and install the red marked package called **Python by Don Jayamanne**.\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/vscode/1.gif\">\n\nNow go to **preference>settings** and open **workspace settings**:\n<img src=\"https://github.com/ruddra/blog-images/raw/master/vscode/2.png\">\n\nHere configure the virtual environment like this:\n```\n{\n    \"python.pythonPath\": \"/path/to/virtualenv/bin/python\",\n}\n```\nThat should be enough to let you use the virtual environment for development.\n\nAfter that, let us add some more features which are useful to develop python codes.\n\n#### Using pep8 and lint:\nTo add them to vs code, add the following key values to above dictionary:\n```\n\"python.linting.pep8Enabled\": true,\n\"python.linting.pylintPath\": \"/path/to/virtualenv/bin/pylint\",\n\"python.linting.pylintArgs\": [\n        \"--load-plugins\",\n        \"pylint_django\"\n    ],\n\"python.linting.pylintEnabled\": true\n```\nTo use the above features, editor will prompt you to install **pylint** and **autopep8**, or you can install them directly in virtual environment:\n```\npip install autopep8\npip install pylint\n```\n#### Format On Save:\nAdd this like in dict: `\"editor.formatOnSave\": true`\nIt will auto format code (language does not matter).\n\n#### Add ruler in editor:\nAdding rulers in editor gives you a better idea of how many words will you put on a single line, in Pep8 Standard, it's 79. So let's add the following key and values in the settings dictionary:\n\n```\n\"editor.rulers\": [\n        80,\n        120\n    ],\n```\n\n#### Ignoring unnecessary files:\nTo ignore unnecessary files, add this following lines:\n\n```\n\"files.exclude\": {\n        \"**/.git\": true,\n        \"**/.svn\": true,\n        \"**/.hg\": true,\n        \"**/CVS\": true,\n        \"**/.DS_Store\": true,\n        \".vscode\": true,\n        \"**/*.pyc\": true\n    },\n```\n#### Disable preview:\nWhen you open a file using an import file or try to go back to the daclaration of the code, vs code intends to open it in a preview window, which sometimes is annoying when you want to do it multiple steps/times. To disable it, add this:\n\n```\n\"workbench.editor.enablePreview\": false,\n```\n\n### Debugging\nIt is really cool to have debugging feature built-in VS Code. Although as far as I tested, it works perfectly fine on Ubuntu, but not in OSX. So please check before you configure it.\n\nAnyways, the best way to configure it for **Django** is to add the following lines in **launch.js**:\n\n```\n{\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n        {\n            \"name\": \"Django\",\n            \"type\": \"python\",\n            \"request\": \"launch\",\n            \"stopOnEntry\": true,\n            \"pythonPath\": \"${config:python.pythonPath}\",\n            \"program\": \"${workspaceRoot}/manage.py\",\n            \"cwd\": \"${workspaceRoot}\",\n            \"args\": [\n                \"runserver\",\n                \"--noreload\",\n                \"--nothreading\"\n            ],\n            \"env\": {},\n            \"envFile\": \"${workspaceRoot}/../virtualenv\",  //virtualenv pat\n            \"debugOptions\": [\n                \"WaitOnAbnormalExit\",\n                \"WaitOnNormalExit\",\n                \"RedirectOutput\",\n                \"DjangoDebugging\"\n            ]\n        }\n    ]\n}\n```\n\nOr go to Debug section(Marked green in the screenshot), click the section marked as yellow and then click add configuration. \n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/vscode/3.gif\">\n\nThen, click on Django settings to add new Django settings for debugging.\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/vscode/4.gif\">\n\n### Useful plugins:\n1. Use <a href=\"https://marketplace.visualstudio.com/items?itemName=Shan.code-settings-sync\">Sync</a> to synchronize your settings in between VS Code instances over multiple machines.\n2. You can use <a href=\"https://marketplace.visualstudio.com/items?itemName=waderyan.gitblame\">Git Blame</a> to see Git blames.\n3. <a href=\"https://github.com/k--kato/vscode-intellij-idea-keybindings\">IntellijIdea Keybindings</a> allows you to use Idea's shortcut keys in VSCode.\n4. Use <a href=\"https://marketplace.visualstudio.com/items?itemName=robertohuertasm.vscode-icons\">Icons</a> to beautify VS Code's icons.\n\n### Side Notes:\nIt goes without saying that Pycharm is the best IDE for Python development. It supports refactoring, which makes life a lot easier, has advanced debugging, and configuring it really easy. Still, VS Code has its own charm. I prefer VS code's UI, its configurations(which is really dynamic and lots of options) and most importantly, I can do front end development better in VS Code, as Pycharm community edition does not support JS.\n\nThanks for reading. Cheers!!", "id": "33", "title": "Using VS Code for Python/Django Development"}, {"published_at": "2451-07-04 10:00:00", "markdown": "If you want to use Openshift for deploying Django, you can follow this post and simply do that. You don't need to learn Kubernetes. We will use docker file only. No other fancy stuff.\n\nAlso, before starting, I am also hoping you are little bit familiar with **[Openshift 3](https://www.openshift.com/)** and [oc tools](https://docs.openshift.com/enterprise/3.0/cli_reference/get_started_cli.html). Download oc clients from [here](https://www.openshift.org/download.html)\n\nSo let's get started:\n###Contents of this Post\nIn the blog, we are going to discuss about how we can deploy production grade django server, using mysql as **Database**. We are also going to use **Gunicorn** to deploy Django. We will be using **Whitenoise** to serve static files. We will use **Persistent Volume** provided by Openshift to store media contents.\nA working example for deploying can be found here:\n[Deploying Django in Openshift Github Repo](https://github.com/ruddra/openshift-django)\n\nNow let's discuss part by part about the deployment.\n\n\n### Deploying Database\n\nFirst we need to deploy our mysql server to Openshift. We are going to do that using this command:\n```\noc new-app openshift/mysql-55-centos7\n```\nIt will start building the deployment for mysql. But it will throw error as there is no `MYSQL_USER`, `MYSQL_PASSWORD`, `MYSQL_DATABASE` defined in environment variable. So we can update the deployment by this commands:\n\n```\n> oc env dc/mysql-55-centos7 MYSQL_USER=myroot\n\n> oc env dc/mysql-55-centos7 MYSQL_PASSWORD=myroot123\n\n> oc env dc/mysql-55-centos7 MYSQL_DATABASE=mydjango\n```\nYou can check the deployment name using the command `oc status`.\n\nNow our MySQL server is ready inside Openshift and it should look like this:\n\n<img src=\"https://github.com/ruddra/blog-images/raw/master/openshift-django/mysql-deployment.png\">\n\nIn our django application, we can use internal service name(FYI:It did not work for my local machine) `mysql-55-centos7` in **DATABASE_SETTINGS** or we can use internal IP which we can find in `application>pods`. Checkout the list of pods:\n\n![Pods](https://github.com/ruddra/blog-images/raw/master/openshift-django/pods.png)\n\nFind out the **running Pod** of Mysql and when you click on the name, you will go the details page. There you can find the IP like given image given below:\n![Mysql Pod](https://github.com/ruddra/blog-images/raw/master/openshift-django/mysql-pod.png)\n\nYou can update the settings of the Django application like this:\n\n```\nDATABASES = {\n    'default': {\n        'ENGINE': 'django.db.backends.mysql',\n        'NAME': 'mydjango',\n        'USER': 'rootadmin',\n        'PASSWORD': 'rootadmin123',\n        'HOST': '172.17.0.4',  # The IP we get from Pods\n        'PORT': '3306',\n    }\n}\n```\nThat's it, our mysql configuration is done.\n\n\n### Making Django Project\n\nWe need a django application for this deployment right!! So let's create one or if you have one, you can use it(lets hope its not too much complicated). If you have one, then please skip to next section.\n\n```\ndjango-admin.py startproject django-openshift\n```\n\nNow inside the project, lets create an app:\n```\ndjango-admin.py startapp pictures\n```\n\nand add this app to django project:\n\n```\n#inside django settings(django-openshift/django-openshift/settings.py)\n\nINSTALLED_APPS += [\n    'pictures'\n]\n```\n\nLets update the **models.py** of pictures:\n```\nfrom django.db import models\n\n\nclass Pictures(models.Model):\n    image = models.ImageField()\n```\n\nand update the **admin.py**\n```\nfrom django.contrib import admin\nfrom .models import Picture\n\n\nadmin.site.register(Picture)\n```\n\nand add a requirements.pip file in the root directory with the given entries:\n```\ndjango>=2.0\nmysqlclient==1.3.12\npillow==5.0.0\ngunicorn==19.7.1\nwhitenoise==3.3.1\n```\nWe have created a really simple django application where we can upload photos.\n\n###Creating Docker File for Django\nNow lets create the **Dockerfile** for django:\n\n```\nFROM python:3.6\nENV PYTHONUNBUFFERED 1\n\nRUN mkdir /src\nWORKDIR /src\nADD . /src\n\nRUN pip install -r requirements.pip\n\nRUN ./manage.py migrate\nRUN ./manage.py collectstatic --no-input\n\nCMD gunicorn openshift_django.wsgi -b 0.0.0.0:3013\n\nEXPOSE 3013\n```\nIn this dockerfile, we are going to do the following stuffs:\n1. We will be using `python:3.6` official image.\n\n2. We are going to install dependencies from **requirements.pip**.\n\n3. We are going to run database migrations.\n\n4. We are going to put **gunicorn** command which will make the application running in **CMD**.\n\n5. We are going to expose 3013 port.\n\nWe are going to expose 3013 because it's one of the default port for openshift, we can also use 8080 as well.\n\n### Serving Static and Media Contents\nFor serving static files, we are going to use [whitenoise](http://whitenoise.evans.io/en/stable/). Its pretty simple, please go their documentation and check how they configure it in Django.\n\nFor Media content, we are using django's own media serving mechanism. You can update the **urls.py** like this:\n\n```\nfrom django.conf.urls import url, re_path\nfrom django.views.static import serve\nfrom django.conf import settings\n\nurlpatterns += [\n    re_path(r'^media/(?P<path>.*)$', serve, {\n            'document_root': settings.MEDIA_ROOT,\n            }),\n]\n\n```\n\nSo media will be served from url path `/media/*`\n\nNow we need to configure media settings in **settings.py**.\n\n```\nMEDIA_ROOT = '/data/' # Why data? explained in below\nMEDIA_URL='/media/'\n```\nSo, it will store media contents in `/data` directory whenever its uploaded through django.\n\n### Deploying Django to Openshift\n\nThere are many ways to deploy to openshift. You can check (here)[https://docs.openshift.com/enterprise/3.0/dev_guide/deployments.html] for more details. But I can share my ways.\n\n1. Lets say, you have your application in git. So you can deploy it using \n```\noc new-app /path/to/src\n```\nThen it will push the git configurations to openshift. Then openshift will pull code from git, build the image and start deploying it.\n\nOr you can use \n```\noc new-build /path/to/src\n```\n\nIt will push binary to openshift, and openshift will build image from that and start deployment.\n\nIf you want to rebuild the app, you can use\n```\noc start-build ./path/to/src\n``` \nIt will start new build.\n\nNow, if you want to see status of your deployment from console, you can use `oc status` command. If you want to expose your app(it will create url and you can access it through that url), then use this command:\n```\noc expose svc/<your-service-name>\n```\n\n### Allowed Hosts in Django\nOnce deployed, if you try to access the application, you might face errors. And one of the most common error is related `ALLOWED_HOSTS`. There is several ways to avoid this, like you can put \n```\nALLOWED_HOSTS=['*']\n```\nIt will allow all hosts. Or\n\n```\nALLOWED_HOSTS=[\nos.environ.get('OPENSHIFT_DNS', '*')\n]\n```\nAnd you can configure the deployment by adding environment variable like this:\n\n```\noc env svc/<your-service> OPENSHIFT_DNS='YOUR OPENSHIFT DNS'\n```\n\n### Uploading Images in Persistent Volume\n\nWhen you try to upload images, You will face permission errors from Django. To avoid that, you can attach storage(Persistent Volume) to your deployment. To do that, create a storage from console like this given image:\n![image](https://github.com/ruddra/blog-images/raw/master/openshift-django/create-storage.png)\n\nPut any name you want, access mode can **RWO**, size 1 GB or anything you wish.\n\nAfter creating the storage, go to deployment configuration:\n![Image](https://github.com/ruddra/blog-images/raw/master/openshift-django/go-to-deployment-config.png)\nIn the bottom of the page, there is a button called **add storage**, click on that.\nWhile adding the storage, mount path should be the path where you want to access your media files from in file storage. In our application, its `/data` like image below:\n\n![Image](https://github.com/ruddra/blog-images/raw/master/openshift-django/oc-add-storage.png)\n\nThat's about it, you should be able to access your application in exposed url.\n\nFor more advanced stuff, please checkout [Openshift's Blog about how they deploy Django](https://blog.openshift.com/migrating-django-applications-openshift-3/).\n\nThanks for reading. Cheers!!\n\n\n\n\n", "id": "34", "title": "Deploy Django to Openshift 3 Powered by MySQL and Gunicorn"}]